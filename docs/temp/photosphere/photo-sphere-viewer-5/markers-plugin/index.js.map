{"version":3,"sources":["@photo-sphere-viewer/core","three","src/index.ts","src/events.ts","src/MarkersButton.ts","src/MarkersListButton.ts","src/constants.ts","src/MarkersPlugin.ts","src/Marker.ts","src/utils.ts"],"sourcesContent":["module.exports = PhotoSphereViewer","module.exports = THREE","import { DEFAULTS, registerButton } from '@photo-sphere-viewer/core';\nimport * as events from './events';\nimport { MarkersButton } from './MarkersButton';\nimport { MarkersListButton } from './MarkersListButton';\n\nDEFAULTS.lang[MarkersButton.id] = 'Markers';\nDEFAULTS.lang[MarkersListButton.id] = 'Markers list';\nregisterButton(MarkersButton, 'caption:left');\nregisterButton(MarkersListButton, 'caption:left');\n\nexport type { Marker, MarkerType } from './Marker';\nexport { MarkersPlugin } from './MarkersPlugin';\nexport * from './model';\nexport { events };\n\n/** @internal  */\nimport './style.scss';\n","import { TypedEvent } from '@photo-sphere-viewer/core';\nimport type { Marker } from './Marker';\nimport type { MarkersPlugin } from './MarkersPlugin';\n\n/**\n * Base class for events dispatched by {@link MarkersPlugin}\n */\nexport abstract class MarkersPluginEvent extends TypedEvent<MarkersPlugin> {}\n\n/**\n * @event Triggered when the visibility of a marker changes\n */\nexport class MarkerVisibilityEvent extends MarkersPluginEvent {\n    static override readonly type = 'marker-visibility';\n    override type: 'marker-visibility';\n\n    constructor(public readonly marker: Marker, public readonly visible: boolean) {\n        super(MarkerVisibilityEvent.type);\n    }\n}\n\n/**\n * @event Triggered when the animation to a marker is done\n */\nexport class GotoMarkerDoneEvent extends MarkersPluginEvent {\n    static override readonly type = 'goto-marker-done';\n    override type: 'goto-marker-done';\n\n    constructor(public readonly marker: Marker) {\n        super(GotoMarkerDoneEvent.type);\n    }\n}\n\n/**\n * @event Triggered when the user puts the cursor away from a marker\n */\nexport class LeaveMarkerEvent extends MarkersPluginEvent {\n    static override readonly type = 'leave-marker';\n    override type: 'leave-marker';\n\n    constructor(public readonly marker: Marker) {\n        super(LeaveMarkerEvent.type);\n    }\n}\n\n/**\n * @event Triggered when the user puts the cursor hover a marker\n */\nexport class EnterMarkerEvent extends MarkersPluginEvent {\n    static override readonly type = 'enter-marker';\n    override type: 'enter-marker';\n\n    constructor(public readonly marker: Marker) {\n        super(EnterMarkerEvent.type);\n    }\n}\n\n/**\n * @event Triggered when the user clicks on a marker\n */\nexport class SelectMarkerEvent extends MarkersPluginEvent {\n    static override readonly type = 'select-marker';\n    override type: 'select-marker';\n\n    constructor(\n        public readonly marker: Marker,\n        public readonly doubleClick: boolean,\n        public readonly rightClick: boolean\n    ) {\n        super(SelectMarkerEvent.type);\n    }\n}\n\n/**\n * @event Triggered when a marker is selected from the side panel\n */\nexport class SelectMarkerListEvent extends MarkersPluginEvent {\n    static override readonly type = 'select-marker-list';\n    override type: 'select-marker-list';\n\n    constructor(public readonly marker: Marker) {\n        super(SelectMarkerListEvent.type);\n    }\n}\n\n/**\n * @event Triggered when a marker was selected and the user clicks elsewhere\n */\nexport class UnselectMarkerEvent extends MarkersPluginEvent {\n    static override readonly type = 'unselect-marker';\n    override type: 'unselect-marker';\n\n    constructor(public readonly marker: Marker) {\n        super(UnselectMarkerEvent.type);\n    }\n}\n\n/**\n * @event Triggered when the markers are hidden\n */\nexport class HideMarkersEvent extends MarkersPluginEvent {\n    static override readonly type = 'hide-markers';\n    override type: 'hide-markers';\n\n    constructor() {\n        super(HideMarkersEvent.type);\n    }\n}\n\n/**\n * @event Triggered when the markers change\n */\nexport class SetMarkersEvent extends MarkersPluginEvent {\n    static override readonly type = 'set-markers';\n    override type: 'set-markers';\n\n    constructor(public readonly markers: Marker[]) {\n        super(SetMarkersEvent.type);\n    }\n}\n\n/**\n * @event Triggered when the markers are shown\n */\nexport class ShowMarkersEvent extends MarkersPluginEvent {\n    static override readonly type = 'show-markers';\n    override type: 'show-markers';\n\n    constructor() {\n        super(ShowMarkersEvent.type);\n    }\n}\n\n/**\n * @event Used to alter the list of markers displayed in the side-panel\n */\nexport class RenderMarkersListEvent extends MarkersPluginEvent {\n    static override readonly type = 'render-markers-list';\n    override type: 'render-markers-list';\n\n    constructor(\n        /** the list of markers to display, can be modified */\n        public markers: Marker[]\n    ) {\n        super(RenderMarkersListEvent.type);\n    }\n}\n\nexport type MarkersPluginEvents =\n    | MarkerVisibilityEvent\n    | GotoMarkerDoneEvent\n    | LeaveMarkerEvent\n    | EnterMarkerEvent\n    | SelectMarkerEvent\n    | SelectMarkerListEvent\n    | UnselectMarkerEvent\n    | HideMarkersEvent\n    | SetMarkersEvent\n    | ShowMarkersEvent\n    | RenderMarkersListEvent;\n","import type { Navbar } from '@photo-sphere-viewer/core';\nimport { AbstractButton } from '@photo-sphere-viewer/core';\nimport { HideMarkersEvent, ShowMarkersEvent } from './events';\nimport type { MarkersPlugin } from './MarkersPlugin';\nimport pin from './icons/pin.svg';\n\nexport class MarkersButton extends AbstractButton {\n    static override readonly id = 'markers';\n\n    private readonly plugin: MarkersPlugin;\n\n    constructor(navbar: Navbar) {\n        super(navbar, {\n            className: 'psv-markers-button',\n            icon: pin,\n            hoverScale: true,\n            collapsable: true,\n            tabbable: true,\n        });\n\n        this.plugin = this.viewer.getPlugin('markers');\n\n        if (this.plugin) {\n            this.plugin.addEventListener(ShowMarkersEvent.type, this);\n            this.plugin.addEventListener(HideMarkersEvent.type, this);\n\n            this.toggleActive(true);\n        }\n    }\n\n    override destroy() {\n        if (this.plugin) {\n            this.plugin.removeEventListener(ShowMarkersEvent.type, this);\n            this.plugin.removeEventListener(HideMarkersEvent.type, this);\n        }\n\n        super.destroy();\n    }\n\n    override isSupported() {\n        return !!this.plugin;\n    }\n\n    handleEvent(e: Event) {\n        if (e instanceof ShowMarkersEvent) {\n            this.toggleActive(true);\n        } else if (e instanceof HideMarkersEvent) {\n            this.toggleActive(false);\n        }\n    }\n\n    onClick() {\n        this.plugin.toggleAllMarkers();\n    }\n}\n","import type { Navbar } from '@photo-sphere-viewer/core';\nimport { AbstractButton, events } from '@photo-sphere-viewer/core';\nimport { ID_PANEL_MARKERS_LIST } from './constants';\nimport type { MarkersPlugin } from './MarkersPlugin';\nimport pinList from './icons/pin-list.svg';\n\nexport class MarkersListButton extends AbstractButton {\n    static override readonly id = 'markersList';\n\n    private readonly plugin: MarkersPlugin;\n\n    constructor(navbar: Navbar) {\n        super(navbar, {\n            className: ' psv-markers-list-button',\n            icon: pinList,\n            hoverScale: true,\n            collapsable: true,\n            tabbable: true,\n        });\n\n        this.plugin = this.viewer.getPlugin('markers');\n\n        if (this.plugin) {\n            this.viewer.addEventListener(events.ShowPanelEvent.type, this);\n            this.viewer.addEventListener(events.HidePanelEvent.type, this);\n        }\n    }\n\n    override destroy() {\n        this.viewer.removeEventListener(events.ShowPanelEvent.type, this);\n        this.viewer.removeEventListener(events.HidePanelEvent.type, this);\n\n        super.destroy();\n    }\n\n    override isSupported() {\n        return !!this.plugin;\n    }\n\n    handleEvent(e: Event) {\n        if (e instanceof events.ShowPanelEvent) {\n            this.toggleActive(e.panelId === ID_PANEL_MARKERS_LIST);\n        } else if (e instanceof events.HidePanelEvent) {\n            this.toggleActive(false);\n        }\n    }\n\n    onClick() {\n        this.plugin.toggleMarkersList();\n    }\n}\n","import { utils } from '@photo-sphere-viewer/core';\nimport type { Marker } from './Marker';\nimport icon from './icons/pin-list.svg';\n\n/**\n * Namespace for SVG creation\n * @internal\n */\nexport const SVG_NS = 'http://www.w3.org/2000/svg';\n\n/**\n * Property name added to marker elements\n * @internal\n */\nexport const MARKER_DATA = 'psvMarker';\n\n/**\n * Property name added to marker elements (dash-case)\n * @internal\n */\nexport const MARKER_DATA_KEY = utils.dasherize(MARKER_DATA);\n\n/**\n * Panel identifier for marker content\n * @internal\n */\nexport const ID_PANEL_MARKER = 'marker';\n\n/**\n * Panel identifier for markers list\n * @internal\n */\nexport const ID_PANEL_MARKERS_LIST = 'markersList';\n\n/**\n * Markers list template\n * @internal\n */\nexport const MARKERS_LIST_TEMPLATE = (markers: Marker[], title: string) => `\n<div class=\"psv-panel-menu psv-panel-menu--stripped\">\n <h1 class=\"psv-panel-menu-title\">${icon} ${title}</h1>\n <ul class=\"psv-panel-menu-list\">\n   ${markers.map((marker) => `\n   <li data-${MARKER_DATA_KEY}=\"${marker.id}\" class=\"psv-panel-menu-item\" tabindex=\"0\">\n     ${marker.type === 'image' ? `<span class=\"psv-panel-menu-item-icon\"><img src=\"${marker.definition}\"/></span>` : ''}\n     <span class=\"psv-panel-menu-item-label\">${marker.getListContent()}</span>\n   </li>\n   `).join('')}\n </ul>\n</div>\n`;\n","import type { Point, Tooltip, Viewer } from '@photo-sphere-viewer/core';\nimport { AbstractConfigurablePlugin, CONSTANTS, events, PSVError, utils } from '@photo-sphere-viewer/core';\nimport { Vector3 } from 'three';\nimport { ID_PANEL_MARKER, ID_PANEL_MARKERS_LIST, MARKERS_LIST_TEMPLATE, MARKER_DATA, SVG_NS } from './constants';\nimport {\n    EnterMarkerEvent,\n    GotoMarkerDoneEvent,\n    HideMarkersEvent,\n    LeaveMarkerEvent,\n    MarkersPluginEvents,\n    MarkerVisibilityEvent,\n    RenderMarkersListEvent,\n    SelectMarkerEvent,\n    SelectMarkerListEvent,\n    SetMarkersEvent,\n    ShowMarkersEvent,\n    UnselectMarkerEvent,\n} from './events';\nimport { Marker } from './Marker';\nimport { MarkersButton } from './MarkersButton';\nimport { MarkersListButton } from './MarkersListButton';\nimport { MarkerConfig, MarkersPluginConfig, UpdatableMarkersPluginConfig } from './model';\n\nconst getConfig = utils.getConfigParser<MarkersPluginConfig>({\n    clickEventOnMarker: false,\n    gotoMarkerSpeed: '8rpm',\n    markers: null,\n});\n\n/**\n * Displays various markers on the viewer\n */\nexport class MarkersPlugin extends AbstractConfigurablePlugin<\n    MarkersPluginConfig,\n    MarkersPluginConfig,\n    UpdatableMarkersPluginConfig,\n    MarkersPluginEvents\n> {\n    static override readonly id = 'markers';\n    static override readonly configParser = getConfig;\n    static override readonly readonlyOptions: Array<keyof MarkersPluginConfig> = ['markers'];\n\n    private readonly markers: Record<string, Marker> = {};\n\n    private readonly state = {\n        visible: true,\n        showAllTooltips: false,\n        currentMarker: null as Marker,\n        hoveringMarker: null as Marker,\n    };\n\n    private readonly container: HTMLElement;\n    private readonly svgContainer: SVGElement;\n\n    constructor(viewer: Viewer, config: MarkersPluginConfig) {\n        super(viewer, config);\n\n        this.container = document.createElement('div');\n        this.container.className = 'psv-markers';\n        this.container.style.cursor = this.viewer.config.mousemove ? 'move' : 'default';\n\n        this.svgContainer = document.createElementNS(SVG_NS, 'svg');\n        this.svgContainer.setAttribute('class', 'psv-markers-svg-container');\n        this.container.appendChild(this.svgContainer);\n\n        // Markers events via delegation\n        this.container.addEventListener('mouseenter', this, true);\n        this.container.addEventListener('mouseleave', this, true);\n        this.container.addEventListener('mousemove', this, true);\n        this.container.addEventListener('contextmenu', this);\n    }\n\n    /**\n     * @internal\n     */\n    override init() {\n        super.init();\n\n        this.viewer.container.appendChild(this.container);\n\n        // Viewer events\n        this.viewer.addEventListener(events.ClickEvent.type, this);\n        this.viewer.addEventListener(events.DoubleClickEvent.type, this);\n        this.viewer.addEventListener(events.RenderEvent.type, this);\n        this.viewer.addEventListener(events.ConfigChangedEvent.type, this);\n        this.viewer.addEventListener(events.ObjectEnterEvent.type, this);\n        this.viewer.addEventListener(events.ObjectHoverEvent.type, this);\n        this.viewer.addEventListener(events.ObjectLeaveEvent.type, this);\n        this.viewer.addEventListener(events.ReadyEvent.type, this, { once: true });\n    }\n\n    /**\n     * @internal\n     */\n    override destroy() {\n        this.clearMarkers(false);\n\n        this.viewer.unobserveObjects(MARKER_DATA);\n\n        this.viewer.removeEventListener(events.ClickEvent.type, this);\n        this.viewer.removeEventListener(events.DoubleClickEvent.type, this);\n        this.viewer.removeEventListener(events.RenderEvent.type, this);\n        this.viewer.removeEventListener(events.ConfigChangedEvent.type, this);\n        this.viewer.removeEventListener(events.ObjectEnterEvent.type, this);\n        this.viewer.removeEventListener(events.ObjectHoverEvent.type, this);\n        this.viewer.removeEventListener(events.ObjectLeaveEvent.type, this);\n        this.viewer.removeEventListener(events.ReadyEvent.type, this);\n\n        this.viewer.container.removeChild(this.container);\n\n        super.destroy();\n    }\n\n    /**\n     * @internal\n     */\n    handleEvent(e: Event) {\n        switch (e.type) {\n            case events.ReadyEvent.type:\n                if (this.config.markers) {\n                    this.setMarkers(this.config.markers);\n                    delete this.config.markers;\n                }\n                break;\n\n            case events.RenderEvent.type:\n                this.renderMarkers();\n                break;\n\n            case events.ClickEvent.type:\n                this.__onClick(e as events.ClickEvent, false);\n                break;\n\n            case events.DoubleClickEvent.type:\n                this.__onClick(e as events.DoubleClickEvent, true);\n                break;\n\n            case events.ConfigChangedEvent.type:\n                this.container.style.cursor = this.viewer.config.mousemove ? 'move' : 'default';\n                break;\n\n            case events.ObjectEnterEvent.type:\n            case events.ObjectLeaveEvent.type:\n            case events.ObjectHoverEvent.type:\n                if ((e as events.ObjectEvent).userDataKey === MARKER_DATA) {\n                    const event = (e as events.ObjectEvent).originalEvent;\n                    const marker = (e as events.ObjectEvent).object.userData[MARKER_DATA];\n                    switch (e.type) {\n                        case events.ObjectEnterEvent.type:\n                            this.__onMouseEnter(event, marker);\n                            break;\n                        case events.ObjectLeaveEvent.type:\n                            this.__onMouseLeave(event, marker);\n                            break;\n                        case events.ObjectHoverEvent.type:\n                            this.__onMouseMove(event, marker);\n                            break;\n                    }\n                }\n                break;\n\n            case 'mouseenter':\n                this.__onMouseEnter(e as MouseEvent, this.__getTargetMarker(e.target as HTMLElement));\n                break;\n\n            case 'mouseleave':\n                this.__onMouseLeave(e as MouseEvent, this.__getTargetMarker(e.target as HTMLElement));\n                break;\n\n            case 'mousemove':\n                this.__onMouseMove(e as MouseEvent, this.__getTargetMarker(e.target as HTMLElement));\n                break;\n\n            case 'contextmenu':\n                e.preventDefault();\n                break;\n        }\n    }\n\n    /**\n     * Toggles all markers\n     */\n    toggleAllMarkers() {\n        if (this.state.visible) {\n            this.hideAllMarkers();\n        } else {\n            this.showAllMarkers();\n        }\n    }\n\n    /**\n     * Shows all markers\n     */\n    showAllMarkers() {\n        this.state.visible = true;\n\n        this.renderMarkers();\n\n        this.dispatchEvent(new ShowMarkersEvent());\n    }\n\n    /**\n     * Hides all markers\n     */\n    hideAllMarkers() {\n        this.state.visible = false;\n\n        this.renderMarkers();\n\n        this.dispatchEvent(new HideMarkersEvent());\n    }\n\n    /**\n     * Toggles the visibility of all tooltips\n     */\n    toggleAllTooltips() {\n        if (this.state.showAllTooltips) {\n            this.hideAllTooltips();\n        } else {\n            this.showAllTooltips();\n        }\n    }\n\n    /**\n     *  Displays all tooltips\n     */\n    showAllTooltips() {\n        this.state.showAllTooltips = true;\n        Object.values(this.markers).forEach((marker) => {\n            marker.state.staticTooltip = true;\n            marker.showTooltip();\n        });\n    }\n\n    /**\n     * Hides all tooltips\n     */\n    hideAllTooltips() {\n        this.state.showAllTooltips = false;\n        Object.values(this.markers).forEach((marker) => {\n            marker.state.staticTooltip = false;\n            marker.hideTooltip();\n        });\n    }\n\n    /**\n     * Returns the total number of markers\n     */\n    getNbMarkers(): number {\n        return Object.keys(this.markers).length;\n    }\n\n    /**\n     * Returns all the markers\n     */\n    getMarkers(): Marker[] {\n        return Object.values(this.markers);\n    }\n\n    /**\n     * Adds a new marker to viewer\n     * @throws {@link PSVError} when the marker's id is missing or already exists\n     */\n    addMarker(config: MarkerConfig, render = true) {\n        if (this.markers[config.id]) {\n            throw new PSVError(`marker \"${config.id}\" already exists`);\n        }\n\n        const marker = new Marker(this.viewer, config);\n\n        if (marker.isNormal()) {\n            this.container.appendChild(marker.domElement);\n        } else if (marker.isPoly() || marker.isSvg()) {\n            this.svgContainer.appendChild(marker.domElement);\n        } else if (marker.is3d()) {\n            this.viewer.renderer.addObject(marker.threeElement);\n        } else {\n            throw new PSVError('invalid state');\n        }\n\n        this.markers[marker.id] = marker;\n\n        if (render) {\n            this.__afterChangerMarkers();\n        }\n    }\n\n    /**\n     * Returns the internal marker object for a marker id\n     * @throws {@link PSVError} when the marker cannot be found\n     */\n    getMarker(markerId: string | MarkerConfig): Marker {\n        const id = typeof markerId === 'object' ? markerId.id : markerId;\n\n        if (!this.markers[id]) {\n            throw new PSVError(`cannot find marker \"${id}\"`);\n        }\n\n        return this.markers[id];\n    }\n\n    /**\n     * Returns the last marker selected by the user\n     */\n    getCurrentMarker(): Marker {\n        return this.state.currentMarker;\n    }\n\n    /**\n     * Updates the existing marker with the same id\n     * @description Every property can be changed but you can't change its type (Eg: `image` to `html`)\n     */\n    updateMarker(config: MarkerConfig, render = true) {\n        const marker = this.getMarker(config.id);\n\n        marker.update(config);\n\n        if (render) {\n            this.__afterChangerMarkers();\n        }\n    }\n\n    /**\n     * Removes a marker from the viewer\n     */\n    removeMarker(markerId: string | MarkerConfig, render = true) {\n        const marker = this.getMarker(markerId);\n\n        if (marker.isNormal()) {\n            this.container.removeChild(marker.domElement);\n        } else if (marker.isPoly() || marker.isSvg()) {\n            this.svgContainer.removeChild(marker.domElement);\n        } else if (marker.is3d()) {\n            this.viewer.renderer.removeObject(marker.threeElement);\n        }\n\n        if (this.state.hoveringMarker === marker) {\n            this.state.hoveringMarker = null;\n        }\n\n        if (this.state.currentMarker === marker) {\n            this.state.currentMarker = null;\n        }\n\n        marker.destroy();\n        delete this.markers[marker.id];\n\n        if (render) {\n            this.__afterChangerMarkers();\n        }\n    }\n\n    /**\n     * Removes multiple markers\n     */\n    removeMarkers(markerIds: string[], render = true) {\n        markerIds.forEach((markerId) => this.removeMarker(markerId, false));\n\n        if (render) {\n            this.__afterChangerMarkers();\n        }\n    }\n\n    /**\n     * Replaces all markers\n     */\n    setMarkers(markers: MarkerConfig[], render = true) {\n        this.clearMarkers(false);\n\n        markers?.forEach((marker) => {\n            this.addMarker(marker, false);\n        });\n\n        if (render) {\n            this.__afterChangerMarkers();\n        }\n    }\n\n    /**\n     * Removes all markers\n     */\n    clearMarkers(render = true) {\n        Object.keys(this.markers).forEach((markerId) => {\n            this.removeMarker(markerId, false);\n        });\n\n        if (render) {\n            this.__afterChangerMarkers();\n        }\n    }\n\n    /**\n     * Rotate the view to face the marker\n     */\n    gotoMarker(markerId: string | MarkerConfig, speed: string | number = this.config.gotoMarkerSpeed): Promise<void> {\n        const marker = this.getMarker(markerId);\n\n        if (!speed) {\n            this.viewer.rotate(marker.state.position);\n            if (!utils.isNil(marker.config.zoomLvl)) {\n                this.viewer.zoom(marker.config.zoomLvl);\n            }\n            this.dispatchEvent(new GotoMarkerDoneEvent(marker));\n            return Promise.resolve();\n        } else {\n            return this.viewer\n                .animate({\n                    ...marker.state.position,\n                    zoom: marker.config.zoomLvl,\n                    speed: speed,\n                })\n                .then(() => {\n                    this.dispatchEvent(new GotoMarkerDoneEvent(marker));\n                });\n        }\n    }\n\n    /**\n     * Hides a marker\n     */\n    hideMarker(markerId: string | MarkerConfig) {\n        this.toggleMarker(markerId, false);\n    }\n\n    /**\n     * Shows a marker\n     */\n    showMarker(markerId: string | MarkerConfig) {\n        this.toggleMarker(markerId, true);\n    }\n\n    /**\n     * Forces the display of the tooltip of a marker\n     */\n    showMarkerTooltip(markerId: string | MarkerConfig) {\n        const marker = this.getMarker(markerId);\n        marker.state.staticTooltip = true;\n        marker.showTooltip();\n    }\n\n    /**\n     * Hides the tooltip of a marker\n     */\n    hideMarkerTooltip(markerId: string | MarkerConfig) {\n        const marker = this.getMarker(markerId);\n        marker.state.staticTooltip = false;\n        marker.hideTooltip();\n    }\n\n    /**\n     * Toggles a marker visibility\n     */\n    toggleMarker(markerId: string | MarkerConfig, visible?: boolean) {\n        const marker = this.getMarker(markerId);\n        marker.visible = visible === null ? !marker.visible : visible;\n        this.viewer.needsUpdate();\n    }\n\n    /**\n     * Opens the panel with the content of the marker\n     */\n    showMarkerPanel(markerId: string | MarkerConfig) {\n        const marker = this.getMarker(markerId);\n\n        if (marker?.config?.content) {\n            this.viewer.panel.show({\n                id: ID_PANEL_MARKER,\n                content: marker.config.content,\n            });\n        } else {\n            this.hideMarkerPanel();\n        }\n    }\n\n    /**\n     * Closes the panel if currently showing the content of a marker\n     */\n    hideMarkerPanel() {\n        this.viewer.panel.hide(ID_PANEL_MARKER);\n    }\n\n    /**\n     * Toggles the visibility of the list of markers\n     */\n    toggleMarkersList() {\n        if (this.viewer.panel.isVisible(ID_PANEL_MARKERS_LIST)) {\n            this.hideMarkersList();\n        } else {\n            this.showMarkersList();\n        }\n    }\n\n    /**\n     * Opens side panel with the list of markers\n     */\n    showMarkersList() {\n        let markers: Marker[] = [];\n        Object.values(this.markers).forEach((marker) => {\n            if (marker.visible && !marker.config.hideList) {\n                markers.push(marker);\n            }\n        });\n\n        const e = new RenderMarkersListEvent(markers);\n        this.dispatchEvent(e);\n        markers = e.markers;\n\n        this.viewer.panel.show({\n            id: ID_PANEL_MARKERS_LIST,\n            content: MARKERS_LIST_TEMPLATE(markers, this.viewer.config.lang[MarkersButton.id]),\n            noMargin: true,\n            clickHandler: (target) => {\n                const li = utils.getClosest(target, 'li');\n                const markerId = li ? li.dataset[MARKER_DATA] : undefined;\n\n                if (markerId) {\n                    const marker = this.getMarker(markerId);\n\n                    this.dispatchEvent(new SelectMarkerListEvent(marker));\n\n                    this.gotoMarker(marker.id);\n                    this.hideMarkersList();\n                }\n            },\n        });\n    }\n\n    /**\n     * Closes side panel if it contains the list of markers\n     */\n    hideMarkersList() {\n        this.viewer.panel.hide(ID_PANEL_MARKERS_LIST);\n    }\n\n    /**\n     * Updates the visibility and the position of all markers\n     */\n    renderMarkers() {\n        const zoomLevel = this.viewer.getZoomLevel();\n        const viewerPosition = this.viewer.getPosition();\n\n        Object.values(this.markers).forEach((marker) => {\n            let isVisible = this.state.visible && marker.visible;\n            let visibilityChanged = false;\n            let position: Point = null;\n\n            if (isVisible && marker.is3d()) {\n                position = this.__getMarkerPosition(marker);\n                isVisible = this.__isMarkerVisible(marker, position);\n            } else if (isVisible && marker.isPoly()) {\n                const positions = this.__getPolyPositions(marker);\n                isVisible = positions.length > (marker.isPolygon() ? 2 : 1);\n\n                if (isVisible) {\n                    position = this.__getMarkerPosition(marker);\n\n                    const points = positions.map((pos) => pos.x - position.x + ',' + (pos.y - position.y)).join(' ');\n\n                    marker.domElement.setAttributeNS(null, 'points', points);\n                    marker.domElement.setAttributeNS(null, 'transform', `translate(${position.x} ${position.y})`);\n                }\n            } else if (isVisible) {\n                if (marker.state.dynamicSize) {\n                    this.__updateMarkerSize(marker);\n                }\n\n                position = this.__getMarkerPosition(marker);\n                isVisible = this.__isMarkerVisible(marker, position);\n\n                if (isVisible) {\n                    const scale = marker.getScale(zoomLevel, viewerPosition);\n\n                    if (marker.isSvg()) {\n                        // simulate transform-origin relative to SVG element\n                        const x = position.x + marker.state.size.width * marker.state.anchor.x * (1 - scale);\n                        const y = position.y + marker.state.size.height * marker.state.anchor.y * (1 - scale);\n                        marker.domElement.setAttributeNS(\n                            null,\n                            'transform',\n                            `translate(${x}, ${y}) scale(${scale}, ${scale})`\n                        );\n                    } else {\n                        marker.domElement.style.transform = `translate3D(${position.x}px, ${position.y}px, 0px) scale(${scale}, ${scale})`;\n                    }\n                }\n            }\n\n            visibilityChanged = marker.state.visible !== isVisible;\n            marker.state.visible = isVisible;\n            marker.state.position2D = isVisible ? position : null;\n\n            if (!marker.is3d()) {\n                utils.toggleClass(marker.domElement, 'psv-marker--visible', isVisible);\n            }\n\n            if (!isVisible) {\n                marker.hideTooltip();\n            } else if (marker.state.staticTooltip) {\n                marker.showTooltip();\n            } else if (\n                marker.config.tooltip?.trigger === 'click'\n                || (marker === this.state.hoveringMarker && !marker.isPoly())\n            ) {\n                marker.refreshTooltip();\n            } else if (marker !== this.state.hoveringMarker) {\n                marker.hideTooltip();\n            }\n\n            if (visibilityChanged) {\n                this.dispatchEvent(new MarkerVisibilityEvent(marker, isVisible));\n            }\n        });\n    }\n\n    /**\n     * Determines if a point marker is visible<br>\n     * It tests if the point is in the general direction of the camera, then check if it's in the viewport\n     */\n    private __isMarkerVisible(marker: Marker, position: Point): boolean {\n        return marker.state.positions3D[0].dot(this.viewer.state.direction) > 0\n            && position.x + marker.state.size.width >= 0\n            && position.x - marker.state.size.width <= this.viewer.state.size.width\n            && position.y + marker.state.size.height >= 0\n            && position.y - marker.state.size.height <= this.viewer.state.size.height;\n    }\n\n    /**\n     * Computes the real size of a marker\n     * @description This is done by removing all it's transformations (if any) and making it visible\n     * before querying its bounding rect\n     */\n    private __updateMarkerSize(marker: Marker) {\n        const element = marker.domElement;\n\n        element.classList.add('psv-marker--transparent');\n\n        let transform;\n        if (marker.isSvg()) {\n            transform = element.getAttributeNS(null, 'transform');\n            element.removeAttributeNS(null, 'transform');\n        } else {\n            transform = element.style.transform;\n            element.style.transform = '';\n        }\n\n        const rect = element.getBoundingClientRect();\n        marker.state.size = {\n            width: rect.width,\n            height: rect.height,\n        };\n\n        element.classList.remove('psv-marker--transparent');\n\n        if (transform) {\n            if (marker.isSvg()) {\n                element.setAttributeNS(null, 'transform', transform);\n            } else {\n                element.style.transform = transform;\n            }\n        }\n\n        // the size is no longer dynamic once known\n        marker.state.dynamicSize = false;\n    }\n\n    /**\n     * Computes viewer coordinates of a marker\n     */\n    private __getMarkerPosition(marker: Marker): Point {\n        if (marker.isPoly()) {\n            return this.viewer.dataHelper.sphericalCoordsToViewerCoords(marker.state.position);\n        } else {\n            const position = this.viewer.dataHelper.vector3ToViewerCoords(marker.state.positions3D[0]);\n\n            position.x -= marker.state.size.width * marker.state.anchor.x;\n            position.y -= marker.state.size.height * marker.state.anchor.y;\n\n            return position;\n        }\n    }\n\n    /**\n     * Computes viewer coordinates of each point of a polygon/polyline<br>\n     * It handles points behind the camera by creating intermediary points suitable for the projector\n     */\n    private __getPolyPositions(marker: Marker): Point[] {\n        const nbVectors = marker.state.positions3D.length;\n\n        // compute if each vector is visible\n        const positions3D = marker.state.positions3D.map((vector) => {\n            return {\n                vector: vector,\n                visible: vector.dot(this.viewer.state.direction) > 0,\n            };\n        });\n\n        // get pairs of visible/invisible vectors for each invisible vector connected to a visible vector\n        const toBeComputed: { visible: Vector3; invisible: Vector3; index: number }[] = [];\n        positions3D.forEach((pos, i) => {\n            if (!pos.visible) {\n                const neighbours = [\n                    i === 0 ? positions3D[nbVectors - 1] : positions3D[i - 1],\n                    i === nbVectors - 1 ? positions3D[0] : positions3D[i + 1],\n                ];\n\n                neighbours.forEach((neighbour) => {\n                    if (neighbour.visible) {\n                        toBeComputed.push({\n                            visible: neighbour.vector,\n                            invisible: pos.vector,\n                            index: i,\n                        });\n                    }\n                });\n            }\n        });\n\n        // compute intermediary vector for each pair (the loop is reversed for splice to insert at the right place)\n        toBeComputed.reverse().forEach((pair) => {\n            positions3D.splice(pair.index, 0, {\n                vector: this.__getPolyIntermediaryPoint(pair.visible, pair.invisible),\n                visible: true,\n            });\n        });\n\n        // translate vectors to screen pos\n        return positions3D\n            .filter((pos) => pos.visible)\n            .map((pos) => this.viewer.dataHelper.vector3ToViewerCoords(pos.vector));\n    }\n\n    /**\n     * Given one point in the same direction of the camera and one point behind the camera,\n     * computes an intermediary point on the great circle delimiting the half sphere visible by the camera.\n     * The point is shifted by .01 rad because the projector cannot handle points exactly on this circle.\n     * @todo : does not work with fisheye view (must not use the great circle)\n     * @link http://math.stackexchange.com/a/1730410/327208\n     */\n    private __getPolyIntermediaryPoint(P1: Vector3, P2: Vector3): Vector3 {\n        const C = this.viewer.state.direction.clone().normalize();\n        const N = new Vector3().crossVectors(P1, P2).normalize();\n        const V = new Vector3().crossVectors(N, P1).normalize();\n        const X = P1.clone().multiplyScalar(-C.dot(V));\n        const Y = V.clone().multiplyScalar(C.dot(P1));\n        const H = new Vector3().addVectors(X, Y).normalize();\n        const a = new Vector3().crossVectors(H, C);\n        return H.applyAxisAngle(a, 0.01).multiplyScalar(CONSTANTS.SPHERE_RADIUS);\n    }\n\n    /**\n     * Returns the marker associated to an event target\n     */\n    private __getTargetMarker(target: HTMLElement, closest = false): Marker {\n        const target2 = closest ? utils.getClosest(target, '.psv-marker') : target;\n        return target2 ? (target2 as any)[MARKER_DATA] : undefined;\n    }\n\n    /**\n     * Checks if an event target is in the tooltip\n     */\n    private __targetOnTooltip(target: HTMLElement, tooltip: Tooltip): boolean {\n        return target && tooltip ? utils.hasParent(target, tooltip.container) : false;\n    }\n\n    /**\n     * Handles mouse enter events, show the tooltip for non polygon markers\n     */\n    private __onMouseEnter(e: MouseEvent, marker: Marker) {\n        if (marker && !marker.isPoly()) {\n            this.state.hoveringMarker = marker;\n\n            this.dispatchEvent(new EnterMarkerEvent(marker));\n\n            if (!marker.state.staticTooltip && marker.config.tooltip?.trigger === 'hover') {\n                marker.showTooltip(e.clientX, e.clientY);\n            }\n        }\n    }\n\n    /**\n     * Handles mouse leave events, hide the tooltip\n     */\n    private __onMouseLeave(e: MouseEvent, marker: Marker) {\n        // do not hide if we enter the tooltip itself while hovering a polygon\n        if (marker && !(marker.isPoly() && this.__targetOnTooltip(e.relatedTarget as HTMLElement, marker.tooltip))) {\n            this.dispatchEvent(new LeaveMarkerEvent(marker));\n\n            this.state.hoveringMarker = null;\n\n            if (!marker.state.staticTooltip && marker.config.tooltip?.trigger === 'hover') {\n                marker.hideTooltip();\n            }\n        }\n    }\n\n    /**\n     * Handles mouse move events, refreshUi the tooltip for polygon markers\n     */\n    private __onMouseMove(e: MouseEvent, targetMarker?: Marker) {\n        let marker;\n\n        if (targetMarker?.isPoly()) {\n            marker = targetMarker;\n        }\n        // do not hide if we enter the tooltip itself while hovering a polygon\n        else if (\n            this.state.hoveringMarker\n            && this.__targetOnTooltip(e.target as HTMLElement, this.state.hoveringMarker.tooltip)\n        ) {\n            marker = this.state.hoveringMarker;\n        }\n\n        if (marker) {\n            if (!this.state.hoveringMarker) {\n                this.dispatchEvent(new EnterMarkerEvent(marker));\n\n                this.state.hoveringMarker = marker;\n            }\n\n            if (!marker.state.staticTooltip) {\n                marker.showTooltip(e.clientX, e.clientY);\n            }\n        } else if (this.state.hoveringMarker?.isPoly()) {\n            this.dispatchEvent(new LeaveMarkerEvent(this.state.hoveringMarker));\n\n            if (!this.state.hoveringMarker.state.staticTooltip) {\n                this.state.hoveringMarker.hideTooltip();\n            }\n\n            this.state.hoveringMarker = null;\n        }\n    }\n\n    /**\n     * Handles mouse click events, select the marker and open the panel if necessary\n     */\n    private __onClick(e: events.ClickEvent | events.DoubleClickEvent, dblclick: boolean) {\n        let marker = e.data.objects.find((o) => o.userData[MARKER_DATA])?.userData[MARKER_DATA];\n\n        if (!marker) {\n            marker = this.__getTargetMarker(e.data.target, true);\n        }\n\n        if (this.state.currentMarker && this.state.currentMarker !== marker) {\n            this.dispatchEvent(new UnselectMarkerEvent(this.state.currentMarker));\n\n            this.viewer.panel.hide(ID_PANEL_MARKER);\n\n            if (!this.state.showAllTooltips && this.state.currentMarker.config.tooltip?.trigger === 'click') {\n                this.hideMarkerTooltip(this.state.currentMarker.id);\n            }\n\n            this.state.currentMarker = null;\n        }\n\n        if (marker) {\n            this.state.currentMarker = marker;\n\n            this.dispatchEvent(new SelectMarkerEvent(marker, dblclick, e.data.rightclick));\n\n            if (this.config.clickEventOnMarker) {\n                // add the marker to event data\n                e.data.marker = marker;\n            } else {\n                e.stopImmediatePropagation();\n            }\n\n            // the marker could have been deleted in an event handler\n            if (this.markers[marker.id]) {\n                if (marker.config.tooltip?.trigger === 'click') {\n                    if (marker.tooltip) {\n                        this.hideMarkerTooltip(marker);\n                    } else {\n                        this.showMarkerTooltip(marker);\n                    }\n                } else {\n                    this.showMarkerPanel(marker.id);\n                }\n            }\n        }\n    }\n\n    private __afterChangerMarkers() {\n        this.__refreshUi();\n        this.__checkObjectsObserver();\n        this.viewer.needsUpdate();\n        this.dispatchEvent(new SetMarkersEvent(this.getMarkers()));\n    }\n\n    /**\n     * Updates the visiblity of the panel and the buttons\n     */\n    private __refreshUi() {\n        const nbMarkers = Object.values(this.markers).filter((m) => !m.config.hideList).length;\n\n        if (nbMarkers === 0) {\n            if (this.viewer.panel.isVisible(ID_PANEL_MARKERS_LIST) || this.viewer.panel.isVisible(ID_PANEL_MARKER)) {\n                this.viewer.panel.hide();\n            }\n        } else {\n            if (this.viewer.panel.isVisible(ID_PANEL_MARKERS_LIST)) {\n                this.showMarkersList();\n            } else if (this.viewer.panel.isVisible(ID_PANEL_MARKER)) {\n                this.state.currentMarker ? this.showMarkerPanel(this.state.currentMarker.id) : this.viewer.panel.hide();\n            }\n        }\n\n        this.viewer.navbar.getButton(MarkersButton.id, false)?.toggle(nbMarkers > 0);\n        this.viewer.navbar.getButton(MarkersListButton.id, false)?.toggle(nbMarkers > 0);\n    }\n\n    /**\n     * Adds or remove the objects observer if there are 3D markers\n     */\n    private __checkObjectsObserver() {\n        const has3d = Object.values(this.markers).some((marker) => marker.is3d());\n\n        if (has3d) {\n            this.viewer.observeObjects(MARKER_DATA);\n        } else {\n            this.viewer.unobserveObjects(MARKER_DATA);\n        }\n    }\n}\n","import type { Point, Position, Size, Tooltip, TooltipConfig, Viewer } from '@photo-sphere-viewer/core';\nimport { CONSTANTS, PSVError, utils } from '@photo-sphere-viewer/core';\nimport { Group, MathUtils, Mesh, MeshBasicMaterial, Object3D, PlaneGeometry, TextureLoader, Vector3 } from 'three';\nimport { MARKER_DATA, SVG_NS } from './constants';\nimport { MarkerConfig, ParsedMarkerConfig } from './model';\nimport { getPolygonCenter, getPolylineCenter } from './utils';\n\nexport enum MarkerType {\n    image = 'image',\n    imageLayer = 'imageLayer',\n    html = 'html',\n    polygon = 'polygon',\n    polygonPixels = 'polygonPixels',\n    polyline = 'polyline',\n    polylinePixels = 'polylinePixels',\n    square = 'square',\n    rect = 'rect',\n    circle = 'circle',\n    ellipse = 'ellipse',\n    path = 'path',\n}\n\nexport class Marker {\n    readonly type: MarkerType;\n    private readonly element: any;\n\n    /**\n     * The final description of the marker. Either text content, image, url, SVG attributes, etc.\n     */\n    definition: any;\n    visible = true;\n\n    /** @internal */\n    tooltip?: Tooltip;\n    private loader?: TextureLoader;\n\n    config: ParsedMarkerConfig;\n\n    get id(): string {\n        return this.config.id;\n    }\n\n    get data(): any {\n        return this.config.data;\n    }\n\n    get domElement(): HTMLElement | SVGElement {\n        return !this.is3d() ? this.element : null;\n    }\n\n    get threeElement(): Object3D {\n        return this.is3d() ? this.element : null;\n    }\n\n    /** @internal */\n    readonly state = {\n        dynamicSize: false,\n        anchor: null as Point,\n        visible: false,\n        staticTooltip: false,\n        position: null as Position,\n        position2D: null as Point,\n        positions3D: null as Vector3[],\n        size: null as Size,\n    };\n\n    constructor(private readonly viewer: Viewer, config: MarkerConfig) {\n        if (!config.id) {\n            throw new PSVError('missing marker id');\n        }\n\n        this.type = Marker.getType(config);\n\n        // create element\n        if (this.isNormal()) {\n            this.element = document.createElement('div');\n        } else if (this.isPolygon()) {\n            this.element = document.createElementNS(SVG_NS, 'polygon');\n        } else if (this.isPolyline()) {\n            this.element = document.createElementNS(SVG_NS, 'polyline');\n        } else if (this.isSvg()) {\n            const svgType = this.type === MarkerType.square ? 'rect' : this.type;\n            this.element = document.createElementNS(SVG_NS, svgType);\n        } else if (this.is3d()) {\n            this.element = this.__createMesh();\n            this.loader = new TextureLoader();\n            if (this.viewer.config.withCredentials) {\n                this.loader.setWithCredentials(true);\n            }\n        }\n\n        if (!this.is3d()) {\n            this.element.id = `psv-marker-${config.id}`;\n            this.element[MARKER_DATA] = this;\n        }\n\n        this.update(config);\n    }\n\n    /**\n     * @internal\n     */\n    destroy() {\n        this.hideTooltip();\n\n        if (this.is3d()) {\n            delete this.threeElement.children[0].userData[MARKER_DATA];\n        } else {\n            delete this.element[MARKER_DATA];\n        }\n    }\n\n    /**\n     * Checks if it is a 3D marker (imageLayer)\n     */\n    is3d(): boolean {\n        return this.type === MarkerType.imageLayer;\n    }\n\n    /**\n     * Checks if it is a normal marker (image or html)\n     */\n    isNormal(): boolean {\n        return this.type === MarkerType.image\n            || this.type === MarkerType.html;\n    }\n\n    /**\n     * Checks if it is a polygon/polyline marker\n     */\n    isPoly(): boolean {\n        return this.isPolygon()\n            || this.isPolyline();\n    }\n\n    /**\n     * Checks if it is a polygon/polyline using pixel coordinates\n     */\n    isPolyPixels(): boolean {\n        return this.type === MarkerType.polygonPixels\n            || this.type === MarkerType.polylinePixels;\n    }\n\n    /**\n     * Checks if it is a polygon/polyline using radian coordinates\n     */\n    isPolyAngles(): boolean {\n        return this.type === MarkerType.polygon\n            || this.type === MarkerType.polyline;\n    }\n\n    /**\n     * Checks if it is a polygon marker\n     */\n    isPolygon(): boolean {\n        return this.type === MarkerType.polygon\n            || this.type === MarkerType.polygonPixels;\n    }\n\n    /**\n     * Checks if it is a polyline marker\n     */\n    isPolyline(): boolean {\n        return this.type === MarkerType.polyline\n            || this.type === MarkerType.polylinePixels;\n    }\n\n    /**\n     * Checks if it is an SVG marker\n     */\n    isSvg(): boolean {\n        return this.type === MarkerType.square\n            || this.type === MarkerType.rect\n            || this.type === MarkerType.circle\n            || this.type === MarkerType.ellipse\n            || this.type === MarkerType.path;\n    }\n\n    /**\n     * Computes marker scale\n     * @internal\n     */\n    getScale(zoomLevel: number, position: Position): number {\n        if (!this.config.scale) {\n            return 1;\n        }\n        if (typeof this.config.scale === 'function') {\n            return this.config.scale(zoomLevel, position);\n        }\n\n        let scale = 1;\n        if (Array.isArray(this.config.scale.zoom)) {\n            const [min, max] = this.config.scale.zoom;\n            scale *= min + (max - min) * CONSTANTS.EASINGS.inQuad(zoomLevel / 100);\n        }\n        if (Array.isArray(this.config.scale.yaw)) {\n            const [min, max] = this.config.scale.yaw;\n            const halfFov = MathUtils.degToRad(this.viewer.state.hFov) / 2;\n            const arc = Math.abs(utils.getShortestArc(this.state.position.yaw, position.yaw));\n            scale *= max + (min - max) * CONSTANTS.EASINGS.outQuad(Math.max(0, (halfFov - arc) / halfFov));\n        }\n        return scale;\n    }\n\n    /**\n     * Returns the markers list content for the marker, it can be either :\n     * - the `listContent`\n     * - the `tooltip`\n     * - the `html`\n     * - the `id`\n     * @internal\n     */\n    getListContent(): string {\n        if (this.config.listContent) {\n            return this.config.listContent;\n        } else if (this.config.tooltip?.content) {\n            return this.config.tooltip.content;\n        } else if (this.config.html) {\n            return this.config.html;\n        } else {\n            return this.id;\n        }\n    }\n\n    /**\n     * Display the tooltip of this marker\n     * @internal\n     */\n    showTooltip(clientX?: number, clientY?: number) {\n        if (this.state.visible && this.config.tooltip?.content && this.state.position2D) {\n            const config: TooltipConfig = {\n                ...this.config.tooltip,\n                data: this,\n                top: 0,\n                left: 0,\n            };\n\n            if (this.isPoly()) {\n                if (clientX || clientY) {\n                    const viewerPos = utils.getPosition(this.viewer.container);\n                    config.top = clientY - viewerPos.y;\n                    config.left = clientX - viewerPos.x;\n                    config.box = {\n                        // separate the tooltip from the cursor\n                        width: 20,\n                        height: 20,\n                    };\n                } else {\n                    config.top = this.state.position2D.y;\n                    config.left = this.state.position2D.x;\n                }\n            } else {\n                config.top = this.state.position2D.y + this.state.size.height / 2;\n                config.left = this.state.position2D.x + this.state.size.width / 2;\n                config.box = {\n                    width: this.state.size.width,\n                    height: this.state.size.height,\n                };\n            }\n\n            if (this.tooltip) {\n                this.tooltip.move(config);\n            } else {\n                this.tooltip = this.viewer.createTooltip(config);\n            }\n        }\n    }\n\n    /**\n     * Recompute the position of the tooltip\n     * @internal\n     */\n    refreshTooltip() {\n        if (this.tooltip) {\n            this.showTooltip();\n        }\n    }\n\n    /**\n     * Hides the tooltip of this marker\n     * @internal\n     */\n    hideTooltip() {\n        if (this.tooltip) {\n            this.tooltip.hide();\n            this.tooltip = null;\n        }\n    }\n\n    /**\n     * Updates the marker with new properties\n     * @throws {@link PSVError} if the configuration is invalid\n     * @internal\n     */\n    update(config: MarkerConfig) {\n        const newType = Marker.getType(config, true);\n\n        if (newType !== undefined && newType !== this.type) {\n            throw new PSVError('cannot change marker type');\n        }\n\n        if (utils.isExtendedPosition(config)) {\n            utils.logWarn('Use the \"position\" property to configure the position of a marker');\n            config.position = this.viewer.dataHelper.cleanPosition(config);\n        }\n\n        if ('width' in config && 'height' in config) {\n            utils.logWarn('Use the \"size\" property to configure the size of a marker');\n            // @ts-ignore\n            config.size = { width: config['width'], height: config['height'] };\n        }\n\n        this.config = utils.deepmerge(this.config, config as any);\n        if (typeof this.config.tooltip === 'string') {\n            this.config.tooltip = { content: this.config.tooltip };\n        }\n        if (this.config.tooltip && !this.config.tooltip.trigger) {\n            this.config.tooltip.trigger = 'hover';\n        }\n        if (this.config.scale && Array.isArray(this.config.scale)) {\n            this.config.scale = { zoom: this.config.scale as any };\n        }\n\n        this.visible = this.config.visible !== false;\n\n        this.state.anchor = utils.parsePoint(this.config.anchor);\n\n        if (!this.is3d()) {\n            const element = this.domElement;\n\n            // reset CSS class\n            if (this.isNormal()) {\n                element.setAttribute('class', 'psv-marker psv-marker--normal');\n            } else {\n                element.setAttribute('class', 'psv-marker psv-marker--svg');\n            }\n\n            // add CSS classes\n            if (this.config.className) {\n                utils.addClasses(element, this.config.className);\n            }\n\n            if (this.config.tooltip) {\n                element.classList.add('psv-marker--has-tooltip');\n            }\n            if (this.config.content) {\n                element.classList.add('psv-marker--has-content');\n            }\n\n            // apply style\n            element.style.opacity = `${this.config.opacity ?? 1}`;\n            if (this.config.style) {\n                Object.assign(element.style, this.config.style);\n            }\n        }\n\n        if (this.isNormal()) {\n            this.__updateNormal();\n        } else if (this.isPoly()) {\n            this.__updatePoly();\n        } else if (this.isSvg()) {\n            this.__updateSvg();\n        } else if (this.is3d()) {\n            this.__update3d();\n        }\n    }\n\n    /**\n     * Updates a normal marker\n     */\n    private __updateNormal() {\n        const element = this.domElement;\n\n        if (!utils.isExtendedPosition(this.config.position)) {\n            throw new PSVError('missing marker position');\n        }\n        if (this.config.image && !this.config.size) {\n            throw new PSVError('missing marker size');\n        }\n\n        if (this.config.size) {\n            this.state.dynamicSize = false;\n            this.state.size = this.config.size;\n            element.style.width = this.config.size.width + 'px';\n            element.style.height = this.config.size.height + 'px';\n        } else {\n            this.state.dynamicSize = true;\n        }\n\n        if (this.config.image) {\n            this.definition = this.config.image;\n            element.style.backgroundImage = `url(${this.config.image})`;\n        } else if (this.config.html) {\n            this.definition = this.config.html;\n            element.innerHTML = this.config.html;\n        }\n\n        // set anchor\n        element.style.transformOrigin = `${this.state.anchor.x * 100}% ${this.state.anchor.y * 100}%`;\n\n        // convert texture coordinates to spherical coordinates\n        this.state.position = this.viewer.dataHelper.cleanPosition(this.config.position);\n\n        // compute x/y/z position\n        this.state.positions3D = [this.viewer.dataHelper.sphericalCoordsToVector3(this.state.position)];\n    }\n\n    /**\n     * Updates an SVG marker\n     */\n    private __updateSvg() {\n        const element = this.domElement;\n\n        if (!utils.isExtendedPosition(this.config.position)) {\n            throw new PSVError('missing marker position');\n        }\n\n        this.state.dynamicSize = true;\n\n        // set content\n        switch (this.type) {\n            case MarkerType.square:\n                this.definition = {\n                    x: 0,\n                    y: 0,\n                    width: this.config.square,\n                    height: this.config.square,\n                };\n                break;\n\n            case MarkerType.rect:\n                if (Array.isArray(this.config.rect)) {\n                    this.definition = {\n                        x: 0,\n                        y: 0,\n                        width: this.config.rect[0],\n                        height: this.config.rect[1],\n                    };\n                } else {\n                    this.definition = {\n                        x: 0,\n                        y: 0,\n                        width: this.config.rect.width,\n                        height: this.config.rect.height,\n                    };\n                }\n                break;\n\n            case MarkerType.circle:\n                this.definition = {\n                    cx: this.config.circle,\n                    cy: this.config.circle,\n                    r: this.config.circle,\n                };\n                break;\n\n            case MarkerType.ellipse:\n                if (Array.isArray(this.config.ellipse)) {\n                    this.definition = {\n                        cx: this.config.ellipse[0],\n                        cy: this.config.ellipse[1],\n                        rx: this.config.ellipse[0],\n                        ry: this.config.ellipse[1],\n                    };\n                } else {\n                    this.definition = {\n                        cx: this.config.ellipse.rx,\n                        cy: this.config.ellipse.ry,\n                        rx: this.config.ellipse.rx,\n                        ry: this.config.ellipse.ry,\n                    };\n                }\n                break;\n\n            case MarkerType.path:\n                this.definition = {\n                    d: this.config.path,\n                };\n                break;\n\n            // no default\n        }\n\n        Object.entries(this.definition).forEach(([prop, value]) => {\n            element.setAttributeNS(null, prop, value as string);\n        });\n\n        // set style\n        if (this.config.svgStyle) {\n            Object.entries(this.config.svgStyle).forEach(([prop, value]) => {\n                element.setAttributeNS(null, utils.dasherize(prop), value);\n            });\n        } else {\n            element.setAttributeNS(null, 'fill', 'rgba(0,0,0,0.5)');\n        }\n\n        // convert texture coordinates to spherical coordinates\n        this.state.position = this.viewer.dataHelper.cleanPosition(this.config.position);\n\n        // compute x/y/z position\n        this.state.positions3D = [this.viewer.dataHelper.sphericalCoordsToVector3(this.state.position)];\n    }\n\n    /**\n     * Updates a polygon marker\n     */\n    private __updatePoly() {\n        const element = this.domElement;\n\n        this.state.dynamicSize = true;\n\n        // set style\n        if (this.config.svgStyle) {\n            Object.entries(this.config.svgStyle).forEach(([prop, value]) => {\n                element.setAttributeNS(null, utils.dasherize(prop), value);\n            });\n\n            if (this.isPolyline() && !this.config.svgStyle.fill) {\n                element.setAttributeNS(null, 'fill', 'none');\n            }\n        } else if (this.isPolygon()) {\n            element.setAttributeNS(null, 'fill', 'rgba(0,0,0,0.5)');\n        } else if (this.isPolyline()) {\n            element.setAttributeNS(null, 'fill', 'none');\n            element.setAttributeNS(null, 'stroke', 'rgb(0,0,0)');\n        }\n\n        // fold arrays: [1,2,3,4] => [[1,2],[3,4]]\n        const actualPoly: any = this.config[this.type];\n        if (!Array.isArray(actualPoly[0])) {\n            for (let i = 0; i < actualPoly.length; i++) {\n                // @ts-ignore\n                actualPoly.splice(i, 2, [actualPoly[i], actualPoly[i + 1]]);\n            }\n        }\n\n        // convert texture coordinates to spherical coordinates\n        if (this.isPolyPixels()) {\n            this.definition = (actualPoly as [number, number][]).map((coord) => {\n                const sphericalCoords = this.viewer.dataHelper.textureCoordsToSphericalCoords({\n                    textureX: coord[0],\n                    textureY: coord[1],\n                });\n                return [sphericalCoords.yaw, sphericalCoords.pitch];\n            });\n        }\n        // clean angles\n        else {\n            this.definition = (actualPoly as [number | string, number | string][]).map((coord) => {\n                return [utils.parseAngle(coord[0]), utils.parseAngle(coord[1], true)];\n            });\n        }\n\n        const centroid = this.isPolygon() ? getPolygonCenter(this.definition) : getPolylineCenter(this.definition);\n\n        this.state.position = {\n            yaw: centroid[0],\n            pitch: centroid[1],\n        };\n\n        // compute x/y/z positions\n        this.state.positions3D = (this.definition as [number, number][]).map((coord) => {\n            return this.viewer.dataHelper.sphericalCoordsToVector3({ yaw: coord[0], pitch: coord[1] });\n        });\n    }\n\n    /**\n     * Updates a 3D marker\n     */\n    private __update3d() {\n        const element = this.threeElement;\n\n        if (!utils.isExtendedPosition(this.config.position)) {\n            throw new PSVError('missing marker position');\n        }\n        if (!this.config.size) {\n            throw new PSVError('missing marker size');\n        }\n\n        this.state.dynamicSize = false;\n        this.state.size = this.config.size;\n\n        // convert texture coordinates to spherical coordinates\n        this.state.position = this.viewer.dataHelper.cleanPosition(this.config.position);\n\n        // compute x/y/z position\n        this.state.positions3D = [this.viewer.dataHelper.sphericalCoordsToVector3(this.state.position)];\n\n        switch (this.type) {\n            case MarkerType.imageLayer:\n                if (this.definition !== this.config.imageLayer) {\n                    if (this.viewer.config.requestHeaders) {\n                        this.loader.setRequestHeader(this.viewer.config.requestHeaders(this.config.imageLayer));\n                    }\n                    (element.children[0] as Mesh<any, MeshBasicMaterial>).material.map = this.loader.load(\n                        this.config.imageLayer,\n                        (texture) => {\n                            texture.anisotropy = 4;\n                            this.viewer.needsUpdate();\n                        }\n                    );\n                    this.definition = this.config.imageLayer;\n                }\n\n                (element.children[0] as Mesh).position.set(this.state.anchor.x - 0.5, this.state.anchor.y - 0.5, 0);\n\n                (element.children[0] as Mesh<any, MeshBasicMaterial>).material.opacity = this.config.opacity ?? 1;\n\n                element.position.copy(this.state.positions3D[0]);\n\n                switch (this.config.orientation) {\n                    case 'horizontal':\n                        element.lookAt(0, element.position.y, 0);\n                        element.rotateX(this.state.position.pitch < 0 ? -Math.PI / 2 : Math.PI / 2);\n                        break;\n                    case 'vertical-left':\n                        element.lookAt(0, 0, 0);\n                        element.rotateY(-Math.PI * 0.4);\n                        break;\n                    case 'vertical-right':\n                        element.lookAt(0, 0, 0);\n                        element.rotateY(Math.PI * 0.4);\n                        break;\n                    default:\n                        element.lookAt(0, 0, 0);\n                        break;\n                }\n\n                // 100 is magic number that gives a coherent size at default zoom level\n                element.scale.set(this.config.size.width / 100, this.config.size.height / 100, 1);\n                break;\n\n            // no default\n        }\n    }\n\n    private __createMesh() {\n        const material = new MeshBasicMaterial({\n            transparent: true,\n            opacity: 1,\n            depthTest: false,\n        });\n        const geometry = new PlaneGeometry(1, 1);\n        const mesh = new Mesh(geometry, material);\n        mesh.userData = { [MARKER_DATA]: this };\n        const element = new Group().add(mesh);\n\n        // overwrite the visible property to be tied to the Marker instance\n        // and do it without context bleed\n        Object.defineProperty(element, 'visible', {\n            enumerable: true,\n            get: function (this: Object3D) {\n                return (this.children[0].userData[MARKER_DATA] as Marker).visible;\n            },\n            set: function (this: Object3D, visible: boolean) {\n                (this.children[0].userData[MARKER_DATA] as Marker).visible = visible;\n            },\n        });\n\n        return element;\n    }\n\n    /**\n     * Determines the type of a marker by the available properties\n     * @throws {@link PSVError} when the marker's type cannot be found\n     */\n    static getType(config: MarkerConfig, allowNone = false): MarkerType {\n        const found: MarkerType[] = [];\n\n        Object.keys(MarkerType).forEach((type) => {\n            if ((config as any)[type]) {\n                found.push(type as MarkerType);\n            }\n        });\n\n        if (found.length === 0 && !allowNone) {\n            throw new PSVError(`missing marker content, either ${Object.keys(MarkerType).join(', ')}`);\n        } else if (found.length > 1) {\n            throw new PSVError(`multiple marker content, either ${Object.keys(MarkerType).join(', ')}`);\n        }\n\n        return found[0];\n    }\n}\n","import { CONSTANTS, utils } from '@photo-sphere-viewer/core';\n\n/**\n * Returns intermediary point between two points on the sphere\n * {@link http://www.movable-type.co.uk/scripts/latlong.html}\n * @internal\n */\nexport function greatArcIntermediaryPoint(p1: [number, number], p2: [number, number], f: number): [number, number] {\n    const [λ1, φ1] = p1;\n    const [λ2, φ2] = p2;\n\n    const r = utils.greatArcDistance(p1, p2);\n    const a = Math.sin((1 - f) * r) / Math.sin(r);\n    const b = Math.sin(f * r) / Math.sin(r);\n    const x = a * Math.cos(φ1) * Math.cos(λ1) + b * Math.cos(φ2) * Math.cos(λ2);\n    const y = a * Math.cos(φ1) * Math.sin(λ1) + b * Math.cos(φ2) * Math.sin(λ2);\n    const z = a * Math.sin(φ1) + b * Math.sin(φ2);\n\n    return [Math.atan2(y, x), Math.atan2(z, Math.sqrt(x * x + y * y))];\n}\n\n/**\n * Given a list of spherical points, offsets yaws in order to have only coutinuous values\n * eg: [0.2, 6.08] is transformed to [0.2, -0.2]\n */\nfunction getPolygonCoherentPoints(points: [number, number][]) {\n    const workPoints = [points[0]];\n\n    let k = 0;\n    for (let i = 1; i < points.length; i++) {\n        const d = points[i - 1][0] - points[i][0];\n        if (d > Math.PI) {\n            // crossed the origin left to right\n            k += 1;\n        } else if (d < -Math.PI) {\n            // crossed the origin right to left\n            k -= 1;\n        }\n        workPoints.push([points[i][0] + k * 2 * Math.PI, points[i][1]]);\n    }\n\n    return workPoints;\n}\n\n/**\n * Computes the center point of a polygon\n * @todo Get \"visual center\" (https://blog.mapbox.com/a-new-algorithm-for-finding-a-visual-center-of-a-polygon-7c77e6492fbc)\n * @internal\n */\nexport function getPolygonCenter(polygon: [number, number][]): [number, number] {\n    const points = getPolygonCoherentPoints(polygon);\n\n    const sum = points.reduce((intermediary, point) => [intermediary[0] + point[0], intermediary[1] + point[1]]);\n    return [utils.parseAngle(sum[0] / polygon.length), sum[1] / polygon.length];\n}\n\n/**\n * Computes the middle point of a polyline\n * @internal\n */\nexport function getPolylineCenter(polyline: [number, number][]): [number, number] {\n    const points = getPolygonCoherentPoints(polyline);\n\n    // compute each segment length + total length\n    let length = 0;\n    const lengths = [];\n\n    for (let i = 0; i < points.length - 1; i++) {\n        const l = utils.greatArcDistance(points[i], points[i + 1]) * CONSTANTS.SPHERE_RADIUS;\n\n        lengths.push(l);\n        length += l;\n    }\n\n    // iterate until length / 2\n    let consumed = 0;\n\n    for (let j = 0; j < points.length - 1; j++) {\n        // once the segment containing the middle point is found, computes the intermediary point\n        if (consumed + lengths[j] > length / 2) {\n            const r = (length / 2 - consumed) / lengths[j];\n            return greatArcIntermediaryPoint(points[j], points[j + 1], r);\n        }\n\n        consumed += lengths[j];\n    }\n\n    // this never happens\n    return points[Math.round(points.length / 2)];\n}\n"],"mappings":"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","names":["import_core","import_core","import_core","import_core","import_core","import_three","import_core","import_core","MarkerType"]}