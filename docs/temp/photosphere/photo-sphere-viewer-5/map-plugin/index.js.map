{"version":3,"sources":["@photo-sphere-viewer/core","three","src/index.ts","src/events.ts","src/MapPlugin.ts","src/components/MapComponent.ts","src/constants.ts","src/utils.ts","src/components/MapCloseButton.ts","src/components/AbstractMapButton.ts","src/components/MapCompassButton.ts","src/components/MapMaximizeButton.ts","src/components/MapResetButton.ts","src/components/MapZoomToolbar.ts"],"sourcesContent":["module.exports = PhotoSphereViewer","module.exports = THREE","import { DEFAULTS } from '@photo-sphere-viewer/core';\nimport * as events from './events';\n\nDEFAULTS.lang['map'] = 'Map';\nDEFAULTS.lang['mapMaximize'] = 'Maximize';\nDEFAULTS.lang['mapMinimize'] = 'Minimize';\nDEFAULTS.lang['mapReset'] = 'Reset';\n\nexport { MapPlugin } from './MapPlugin';\nexport * from './model';\nexport { events };\n\n/** @internal  */\nimport './style.scss';\n","import { TypedEvent } from '@photo-sphere-viewer/core';\nimport type { MapPlugin } from './MapPlugin';\n\n/**\n * Triggered when the user clicks on a hotspot\n */\nexport class SelectHotspot extends TypedEvent<MapPlugin> {\n    static override readonly type = 'select-hotspot';\n    override type: 'select-hotspot';\n\n    constructor(public readonly hotspotId: string) {\n        super(SelectHotspot.type);\n    }\n}\n\nexport type MapPluginEvents = SelectHotspot;\n","import { AbstractConfigurablePlugin, events, Point, utils, Viewer } from '@photo-sphere-viewer/core';\nimport type { events as markersEvents, Marker, MarkersPlugin } from '@photo-sphere-viewer/markers-plugin';\nimport { MapComponent } from './components/MapComponent';\nimport { HOTSPOT_GENERATED_ID, HOTSPOT_MARKER_ID, MARKER_DATA_KEY } from './constants';\nimport { MapPluginEvents } from './events';\nimport overlay from './overlay.svg';\nimport pin from './icons/pin.svg';\nimport { MapHotspot, MapPluginConfig, ParsedMapPluginConfig, UpdatableMapPluginConfig } from './model';\n\nconst getConfig = utils.getConfigParser<MapPluginConfig, ParsedMapPluginConfig>(\n    {\n        imageUrl: null,\n        center: null,\n        rotation: 0,\n        size: '200px',\n        position: ['bottom', 'left'],\n        visibleOnLoad: true,\n        overlayImage: overlay,\n        compassImage: null,\n        pinImage: pin,\n        pinSize: 35,\n        spotColor: 'white',\n        spotImage: null,\n        spotSize: 15,\n        static: false,\n        defaultZoom: 100,\n        minZoom: 20,\n        maxZoom: 200,\n        hotspots: [],\n    },\n    {\n        overlayImage: (overlayImage, { rawConfig }) => {\n            if (rawConfig.compassImage) {\n                utils.logWarn('map: \"compassImage\" is deprecated, use \"overlayImage\" instead');\n                return rawConfig.compassImage;\n            }\n            return overlayImage;\n        },\n        position: (position, { defValue }) => {\n            return utils.cleanCssPosition(position, { allowCenter: false, cssOrder: true }) || defValue;\n        },\n        rotation: (rotation) => utils.parseAngle(rotation),\n        defaultZoom: (defaultZoom) => Math.log(defaultZoom / 100),\n        maxZoom: (maxZoom) => Math.log(maxZoom / 100),\n        minZoom: (minZoom) => Math.log(minZoom / 100),\n    }\n);\n\n/**\n * Adds a minimap on the viewer\n */\nexport class MapPlugin extends AbstractConfigurablePlugin<\n    MapPluginConfig,\n    ParsedMapPluginConfig,\n    UpdatableMapPluginConfig,\n    MapPluginEvents\n> {\n    static override readonly id = 'map';\n    static override readonly configParser = getConfig;\n    static override readonly readonlyOptions: Array<keyof MapPluginConfig> = [\n        'imageUrl',\n        'center',\n        'visibleOnLoad',\n        'hotspots',\n        'defaultZoom',\n    ];\n\n    private markers?: MarkersPlugin;\n    readonly component: MapComponent;\n\n    constructor(viewer: Viewer, config: MapPluginConfig) {\n        super(viewer, config);\n\n        this.component = new MapComponent(this.viewer, this);\n    }\n\n    /**\n     * @internal\n     */\n    override init() {\n        super.init();\n\n        this.markers = this.viewer.getPlugin('markers');\n\n        this.viewer.addEventListener(events.PositionUpdatedEvent.type, this);\n        this.viewer.addEventListener(events.SizeUpdatedEvent.type, this);\n        this.viewer.addEventListener(events.ReadyEvent.type, this, { once: true });\n\n        this.setHotspots(this.config.hotspots, false);\n\n        if (this.markers) {\n            this.markers.addEventListener('set-markers', this);\n        }\n    }\n\n    /**\n     * @internal\n     */\n    override destroy() {\n        this.viewer.removeEventListener(events.PositionUpdatedEvent.type, this);\n        this.viewer.removeEventListener(events.SizeUpdatedEvent.type, this);\n        this.viewer.removeEventListener(events.ReadyEvent.type, this);\n\n        if (this.markers) {\n            this.markers.removeEventListener('set-markers', this);\n        }\n\n        this.component.destroy();\n\n        delete this.markers;\n\n        super.destroy();\n    }\n\n    /**\n     * @internal\n     */\n    handleEvent(e: Event) {\n        switch (e.type) {\n            case events.ReadyEvent.type:\n                this.component.reload(this.config.imageUrl);\n                break;\n            case events.PositionUpdatedEvent.type:\n                this.component.update();\n                break;\n            case events.SizeUpdatedEvent.type:\n                if (this.component.maximized) {\n                    this.component.update();\n                }\n                break;\n            case 'set-markers':\n                this.component.setMarkers(this.__markersToHotspots((e as markersEvents.SetMarkersEvent).markers));\n                break;\n            default:\n                break;\n        }\n    }\n\n    override setOptions(options: Partial<UpdatableMapPluginConfig>) {\n        super.setOptions(options);\n        this.component.applyConfig();\n    }\n\n    /**\n     * Hides the map\n     */\n    hide() {\n        this.component.hide();\n    }\n\n    /**\n     * Shows the map\n     */\n    show() {\n        this.component.show();\n    }\n\n    /**\n     * Closes the map\n     */\n    close() {\n        if (!this.component.collapsed) {\n            this.component.toggleCollapse();\n        }\n    }\n\n    /**\n     * Open the map\n     */\n    open() {\n        if (this.component.collapsed) {\n            this.component.toggleCollapse();\n        }\n    }\n\n    /**\n     * Minimizes the map\n     */\n    minimize() {\n        if (this.component.maximized) {\n            this.component.toggleMaximized();\n        }\n    }\n\n    /**\n     * Maximizes the map\n     */\n    maximize() {\n        if (!this.component.maximized) {\n            this.component.toggleMaximized();\n        }\n    }\n\n    /**\n     * Changes the image of the map\n     * @param rotation Also change the image rotation\n     * @param center Also change the position on the map\n     */\n    setImage(url: string, center?: Point, rotation?: string | number) {\n        if (!utils.isNil(rotation)) {\n            this.config.rotation = utils.parseAngle(rotation);\n        }\n        if (!utils.isNil(center)) {\n            this.config.center = center;\n        }\n        this.component.reload(url);\n    }\n\n    /**\n     * Changes the position on the map\n     */\n    setCenter(center: Point) {\n        this.config.center = center;\n        this.component.recenter();\n    }\n\n    /**\n     * Changes the hotspots on the map\n     */\n    setHotspots(hotspots: MapHotspot[], render = true) {\n        const ids: string[] = [];\n        let i = 1;\n\n        hotspots?.forEach((hotspot) => {\n            if (!hotspot.id) {\n                hotspot.id = HOTSPOT_GENERATED_ID + i++;\n            } else if (ids.includes(hotspot.id)) {\n                utils.logWarn(`Duplicated hotspot id \"${hotspot.id}`);\n            } else {\n                ids.push(hotspot.id);\n            }\n        });\n\n        this.config.hotspots = hotspots || [];\n\n        if (render) {\n            this.component.update();\n        }\n    }\n\n    /**\n     * Removes all hotspots\n     */\n    clearHotspots() {\n        this.setHotspots(null);\n    }\n\n    private __markersToHotspots(markers: Marker[]): MapHotspot[] {\n        return markers\n            .filter((marker) => marker.data?.[MARKER_DATA_KEY])\n            .map((marker) => {\n                const markerData: MapHotspot = marker.data[MARKER_DATA_KEY];\n\n                const hotspot: MapHotspot = {\n                    ...markerData,\n                    id: HOTSPOT_MARKER_ID + marker.id,\n                    tooltip: marker.config.tooltip?.content,\n                };\n\n                if ('distance' in markerData) {\n                    (hotspot as any).yaw = marker.state.position.yaw;\n                } else if (!('x' in markerData) || !('y' in markerData)) {\n                    utils.logWarn(`Marker ${marker.id} \"map\" data is missing position (distance or x+y)`);\n                    return null;\n                }\n\n                return hotspot;\n            })\n            .filter((h) => h);\n    }\n}\n","import type { Point, Tooltip, Viewer } from '@photo-sphere-viewer/core';\nimport { AbstractComponent, CONSTANTS, SYSTEM, utils } from '@photo-sphere-viewer/core';\nimport type { MarkersPlugin } from '@photo-sphere-viewer/markers-plugin';\nimport { MathUtils } from 'three';\nimport { HOTSPOT_MARKER_ID, MAP_SHADOW_BLUR, PIN_SHADOW_BLUR, PIN_SHADOW_OFFSET } from '../constants';\nimport { SelectHotspot } from '../events';\nimport type { MapPlugin } from '../MapPlugin';\nimport { MapHotspot } from '../model';\nimport {\n    canvasShadow,\n    drawImageCentered,\n    drawImageHighDpi,\n    getImageHtml,\n    ImageSource,\n    loadImage,\n    projectPoint,\n    unprojectPoint,\n} from '../utils';\nimport { MapCloseButton } from './MapCloseButton';\nimport { MapCompassButton } from './MapCompassButton';\nimport { MapMaximizeButton } from './MapMaximizeButton';\nimport { MapResetButton } from './MapResetButton';\nimport { MapZoomToolbar } from './MapZoomToolbar';\n\nexport class MapComponent extends AbstractComponent {\n    protected override readonly state = {\n        visible: false,\n        maximized: false,\n        collapsed: false,\n\n        imgScale: 1,\n        zoom: this.config.defaultZoom,\n        offset: { x: 0, y: 0 } as Point,\n\n        mouseX: null as number,\n        mouseY: null as number,\n        mousedown: false,\n        pinchDist: 0,\n        pinchAngle: 0,\n\n        hotspotPos: {} as Record<string, Point & { s: number }>,\n        hotspotId: null as string,\n        hotspotTooltip: null as Tooltip,\n        markers: [] as MapHotspot[],\n\n        forceRender: false,\n        needsUpdate: false,\n        renderLoop: null as ReturnType<typeof requestAnimationFrame>,\n\n        images: {} as Record<string, { loading: boolean; value: ImageSource }>,\n    };\n\n    private readonly canvas: HTMLCanvasElement;\n    private readonly overlay: HTMLElement;\n    private readonly resetButton: MapResetButton;\n    private readonly maximizeButton: MapMaximizeButton;\n    private readonly closeButton: MapCloseButton;\n    private readonly compassButton: MapCompassButton;\n    private readonly zoomToolbar: MapZoomToolbar;\n\n    get config() {\n        return this.plugin.config;\n    }\n\n    get maximized() {\n        return this.state.maximized;\n    }\n\n    get collapsed() {\n        return this.state.collapsed;\n    }\n\n    constructor(viewer: Viewer, private plugin: MapPlugin) {\n        super(viewer, {\n            className: `psv-map ${CONSTANTS.CAPTURE_EVENTS_CLASS}`,\n        });\n\n        // map + compass container\n        const canvasContainer = document.createElement('div');\n        canvasContainer.className = 'psv-map__container';\n\n        canvasContainer.addEventListener('mousedown', this);\n        window.addEventListener('mousemove', this);\n        window.addEventListener('mouseup', this);\n        canvasContainer.addEventListener('touchstart', this);\n        window.addEventListener('touchmove', this);\n        window.addEventListener('touchend', this);\n        canvasContainer.addEventListener('wheel', this);\n\n        // map canvas\n        this.canvas = document.createElement('canvas');\n        canvasContainer.appendChild(this.canvas);\n\n        // overlay\n        this.overlay = document.createElement('div');\n        this.overlay.className = 'psv-map__overlay';\n        canvasContainer.appendChild(this.overlay);\n\n        this.container.appendChild(canvasContainer);\n\n        this.container.addEventListener('transitionstart', this);\n        this.container.addEventListener('transitionend', this);\n\n        // sub-components\n        this.resetButton = new MapResetButton(this);\n        this.maximizeButton = new MapMaximizeButton(this);\n        this.closeButton = new MapCloseButton(this);\n        this.compassButton = new MapCompassButton(this);\n        this.zoomToolbar = new MapZoomToolbar(this);\n\n        // render loop\n        const renderLoop = () => {\n            if (this.isVisible() && (this.state.needsUpdate || this.state.forceRender)) {\n                this.render();\n                this.state.needsUpdate = false;\n            }\n            this.state.renderLoop = requestAnimationFrame(renderLoop);\n        };\n        renderLoop();\n\n        this.applyConfig();\n        this.hide();\n\n        if (!this.config.visibleOnLoad) {\n            this.toggleCollapse();\n        }\n    }\n\n    override destroy(): void {\n        window.removeEventListener('touchmove', this);\n        window.removeEventListener('mousemove', this);\n        window.removeEventListener('touchend', this);\n        window.removeEventListener('mouseup', this);\n\n        cancelAnimationFrame(this.state.renderLoop);\n\n        super.destroy();\n    }\n\n    handleEvent(e: Event) {\n        if (utils.getClosest(e.target as HTMLElement, `.${CONSTANTS.CAPTURE_EVENTS_CLASS}:not(.psv-map)`)) {\n            return;\n        }\n        switch (e.type) {\n            case 'mousedown': {\n                const event = e as MouseEvent;\n                this.state.mouseX = event.clientX;\n                this.state.mouseY = event.clientY;\n                this.state.mousedown = true;\n                e.stopPropagation();\n                break;\n            }\n            case 'touchstart': {\n                const event = e as TouchEvent;\n                if (event.touches.length === 1) {\n                    this.state.mouseX = event.touches[0].clientX;\n                    this.state.mouseY = event.touches[0].clientY;\n                    this.state.mousedown = true;\n                } else if (event.touches.length === 2) {\n                    ({\n                        distance: this.state.pinchDist,\n                        angle: this.state.pinchAngle,\n                        center: { x: this.state.mouseX, y: this.state.mouseY },\n                    } = utils.getTouchData(event));\n                }\n                e.stopPropagation();\n                e.preventDefault();\n                break;\n            }\n            case 'mousemove': {\n                const event = e as MouseEvent;\n                if (this.state.mousedown) {\n                    this.__move(event.clientX, event.clientY);\n                    e.stopPropagation();\n                } else {\n                    this.__handleHotspots(event.clientX, event.clientY);\n                }\n                break;\n            }\n            case 'touchmove': {\n                const event = e as TouchEvent;\n                if (this.state.mousedown && event.touches.length === 1) {\n                    this.__move(event.touches[0].clientX, event.touches[0].clientY);\n                    e.stopPropagation();\n                } else if (this.state.mousedown && event.touches.length === 2) {\n                    const touchData = utils.getTouchData(event);\n                    const delta = (touchData.distance - this.state.pinchDist) / SYSTEM.pixelRatio;\n\n                    this.zoom(delta / 100);\n                    this.__move(touchData.center.x, touchData.center.y);\n\n                    if (this.state.maximized && !this.config.static) {\n                        this.viewer.dynamics.position.step({ yaw: this.state.pinchAngle - touchData.angle }, 0);\n                    }\n\n                    ({ distance: this.state.pinchDist, angle: this.state.pinchAngle } = touchData);\n                    e.stopPropagation();\n                }\n                break;\n            }\n            case 'mouseup':\n            case 'touchend': {\n                const mouse = (e as TouchEvent).changedTouches?.[0] || (e as MouseEvent);\n                if (this.state.mousedown) {\n                    this.state.mousedown = false;\n                    e.stopPropagation();\n                }\n                this.__clickHotspot(mouse.clientX, mouse.clientY);\n                break;\n            }\n            case 'wheel': {\n                const event = e as WheelEvent;\n                const delta = event.deltaY / Math.abs(event.deltaY);\n                this.zoom(-delta / 10);\n                e.stopPropagation();\n                e.preventDefault();\n                break;\n            }\n            case 'transitionstart':\n                this.state.forceRender = true;\n                break;\n            case 'transitionend':\n                if (!this.state.maximized) {\n                    this.overlay.style.display = '';\n                }\n                this.state.forceRender = false;\n                this.update();\n                break;\n        }\n    }\n\n    applyConfig() {\n        this.container.classList.remove(\n            'psv-map--top-right',\n            'psv-map--top-left',\n            'psv-map--bottom-right',\n            'psv-map--bottom-left'\n        );\n        this.container.classList.add(`psv-map--${this.config.position.join('-')}`);\n\n        this.container.style.width = this.config.size;\n        this.container.style.height = this.config.size;\n\n        this.overlay.innerHTML = getImageHtml(this.config.overlayImage);\n\n        this.resetButton.applyConfig();\n        this.closeButton.applyConfig();\n        this.compassButton.applyConfig();\n        this.maximizeButton.applyConfig();\n\n        if (this.config.static) {\n            this.compassButton.rotate(0);\n            this.overlay.style.transform = '';\n        }\n\n        this.update();\n    }\n\n    override isVisible(): boolean {\n        return this.state.visible && !this.state.collapsed;\n    }\n\n    override show() {\n        super.show();\n        this.update();\n        if (!this.state.maximized) {\n            this.overlay.style.display = '';\n        }\n    }\n\n    override hide() {\n        super.hide();\n        this.state.forceRender = false;\n    }\n\n    /**\n     * Flag for render\n     */\n    update() {\n        this.state.needsUpdate = true;\n    }\n\n    /**\n     * Load a new map image\n     */\n    reload(url: string) {\n        delete this.state.images[this.config.imageUrl];\n        this.config.imageUrl = url;\n        this.state.imgScale = 1;\n        this.__loadImage(this.config.imageUrl, true);\n        this.recenter();\n    }\n\n    /**\n     * Clears the offset and zoom level\n     */\n    reset() {\n        this.state.zoom = this.config.defaultZoom;\n        this.recenter();\n    }\n\n    /**\n     * Clears the offset\n     */\n    recenter() {\n        this.state.offset.x = 0;\n        this.state.offset.y = 0;\n        this.update();\n    }\n\n    /**\n     * Switch collapsed mode\n     */\n    toggleCollapse() {\n        if (this.state.maximized) {\n            this.toggleMaximized();\n        }\n\n        this.state.collapsed = !this.state.collapsed;\n\n        utils.toggleClass(this.container, 'psv-map--collapsed', this.state.collapsed);\n\n        if (!this.state.collapsed) {\n            this.reset();\n        }\n\n        this.closeButton.update();\n    }\n\n    /**\n     * Switch maximized mode\n     */\n    toggleMaximized() {\n        if (this.state.collapsed) {\n            return;\n        }\n\n        this.state.maximized = !this.state.maximized;\n\n        utils.toggleClass(this.container, 'psv-map--maximized', this.state.maximized);\n\n        if (this.state.maximized) {\n            this.overlay.style.display = 'none';\n        }\n\n        this.maximizeButton.update();\n    }\n\n    /**\n     * Changes the zoom level\n     */\n    zoom(d: number) {\n        this.state.zoom = MathUtils.clamp(this.state.zoom + d, this.config.minZoom, this.config.maxZoom);\n        this.update();\n    }\n\n    /**\n     * Updates the markers\n     */\n    setMarkers(markers: MapHotspot[]) {\n        this.state.markers = markers;\n        this.update();\n    }\n\n    private render() {\n        if (!this.config.center) {\n            return;\n        }\n\n        // load the map image\n        const mapImage = this.__loadImage(this.config.imageUrl);\n        if (!mapImage) {\n            return;\n        }\n\n        // clear hotspots status\n        this.state.hotspotPos = {};\n        this.__resetHotspot();\n\n        const yaw = this.viewer.getPosition().yaw;\n        const zoom = Math.exp(this.state.zoom) / this.state.imgScale;\n        const center: Point = {\n            x: this.config.center.x * this.state.imgScale,\n            y: this.config.center.y * this.state.imgScale,\n        };\n        const offset: Point = {\n            x: this.state.offset.x * this.state.imgScale,\n            y: this.state.offset.y * this.state.imgScale,\n        };\n        const rotation = this.config.rotation;\n        const yawAndRotation = this.config.static ? 0 : yaw + rotation;\n\n        // update UI\n        if (!this.config.static) {\n            this.overlay.style.transform = `rotate(${-yawAndRotation}rad)`;\n            this.compassButton.rotate(yawAndRotation);\n        }\n        this.zoomToolbar.setText(this.state.zoom);\n\n        // clear canvas\n        this.canvas.width = this.container.clientWidth * SYSTEM.pixelRatio;\n        this.canvas.height = this.container.clientHeight * SYSTEM.pixelRatio;\n\n        const canvasPos = utils.getPosition(this.canvas);\n        const canvasW = this.canvas.width;\n        const canvasH = this.canvas.height;\n        const canvasVirtualCenterX = canvasW / 2 / SYSTEM.pixelRatio;\n        const canvasVirtualCenterY = canvasH / 2 / SYSTEM.pixelRatio;\n\n        const context = this.canvas.getContext('2d');\n        context.clearRect(0, 0, canvasW, canvasH);\n\n        // draw the map\n        const mapW = mapImage.width;\n        const mapH = mapImage.height;\n\n        context.save();\n        context.translate(canvasW / 2, canvasH / 2);\n        context.rotate(-yawAndRotation);\n        context.scale(zoom, zoom);\n        canvasShadow(context, 0, 0, MAP_SHADOW_BLUR);\n        // prettier-ignore\n        drawImageHighDpi(\n            context,\n            mapImage,\n            -center.x - offset.x,\n            -center.y - offset.y,\n            mapW,\n            mapH\n        );\n        context.restore();\n\n        // draw the hotspots\n        [...this.config.hotspots, ...this.state.markers].forEach((hotspot: MapHotspot) => {\n            const image = this.__loadImage(hotspot.image || this.config.spotImage);\n\n            const hotspotPos = { ...offset };\n            if ('yaw' in hotspot && 'distance' in hotspot) {\n                const angle = utils.parseAngle(hotspot.yaw) + rotation;\n                hotspotPos.x += Math.sin(-angle) * hotspot.distance * this.state.imgScale;\n                hotspotPos.y += Math.cos(-angle) * hotspot.distance * this.state.imgScale;\n            } else if ('x' in hotspot && 'y' in hotspot) {\n                hotspotPos.x += center.x - hotspot.x * this.state.imgScale;\n                hotspotPos.y += center.y - hotspot.y * this.state.imgScale;\n            } else {\n                utils.logWarn(`Hotspot ${hotspot['id']} is missing position (yaw+distance or x+y)`);\n                return;\n            }\n\n            const spotPos = projectPoint(hotspotPos, yawAndRotation, zoom);\n\n            // TODO filter out not visible\n\n            const x = canvasVirtualCenterX - spotPos.x;\n            const y = canvasVirtualCenterY - spotPos.y;\n            const size = hotspot.size || this.config.spotSize;\n\n            // save absolute position on the viewer\n            this.state.hotspotPos[hotspot.id] = {\n                x: x + canvasPos.x,\n                y: y + canvasPos.y,\n                s: size,\n            };\n\n            context.save();\n            context.translate(x * SYSTEM.pixelRatio, y * SYSTEM.pixelRatio);\n            canvasShadow(context, PIN_SHADOW_OFFSET, PIN_SHADOW_OFFSET, PIN_SHADOW_BLUR);\n            if (image) {\n                drawImageCentered(context, image, size);\n            } else {\n                context.fillStyle = hotspot.color || this.config.spotColor;\n                context.beginPath();\n                context.arc(0, 0, (size * SYSTEM.pixelRatio) / 2, 0, 2 * Math.PI);\n                context.fill();\n            }\n            context.restore();\n        });\n\n        // draw the pin\n        const pinImage = this.__loadImage(this.config.pinImage);\n        if (pinImage) {\n            const pinPos = projectPoint(offset, yawAndRotation, zoom);\n\n            const x = canvasVirtualCenterX - pinPos.x;\n            const y = canvasVirtualCenterY - pinPos.y;\n            const size = this.config.pinSize;\n            const angle = this.config.static ? yaw + rotation : 0;\n\n            context.save();\n            context.translate(x * SYSTEM.pixelRatio, y * SYSTEM.pixelRatio);\n            context.rotate(angle);\n            canvasShadow(context, PIN_SHADOW_OFFSET, PIN_SHADOW_OFFSET, PIN_SHADOW_BLUR);\n            drawImageCentered(context, pinImage, size);\n            context.restore();\n        }\n    }\n\n    /**\n     * Applies mouse movement to the map\n     */\n    private __move(clientX: number, clientY: number) {\n        const yaw = this.viewer.getPosition().yaw;\n        const zoom = Math.exp(this.state.zoom);\n\n        const move = unprojectPoint(\n            {\n                x: this.state.mouseX - clientX,\n                y: this.state.mouseY - clientY,\n            },\n            this.config.static ? 0 : yaw + this.config.rotation,\n            zoom\n        );\n\n        this.state.offset.x += move.x;\n        this.state.offset.y += move.y;\n\n        this.update();\n\n        this.state.mouseX = clientX;\n        this.state.mouseY = clientY;\n    }\n\n    /**\n     * Finds the hotspot under the mouse\n     */\n    private __findHotspot(clientX: number, clientY: number): string {\n        const k = this.config.spotSize / 2;\n\n        let hotspotId: string = null;\n        for (const [id, { x, y }] of Object.entries(this.state.hotspotPos)) {\n            if (clientX > x - k && clientX < x + k && clientY > y - k && clientY < y + k) {\n                hotspotId = id;\n                break;\n            }\n        }\n\n        return hotspotId;\n    }\n\n    /**\n     * Updates current hotspot on mouse move and displays tooltip\n     */\n    private __handleHotspots(clientX: number, clientY: number) {\n        const hotspotId = this.__findHotspot(clientX, clientY);\n\n        if (this.state.hotspotId !== hotspotId) {\n            this.__resetHotspot();\n\n            if (hotspotId) {\n                let tooltip;\n                if (hotspotId.startsWith(HOTSPOT_MARKER_ID)) {\n                    tooltip = this.state.markers.find(({ id }) => id === hotspotId)?.tooltip;\n                } else {\n                    tooltip = this.config.hotspots.find(({ id }) => id === hotspotId)?.tooltip;\n                }\n\n                if (tooltip) {\n                    const hotspotPos = this.state.hotspotPos[hotspotId];\n                    const viewerPos = utils.getPosition(this.viewer.container);\n\n                    this.state.hotspotTooltip = this.viewer.createTooltip({\n                        content: tooltip,\n                        left: hotspotPos.x - viewerPos.x,\n                        top: hotspotPos.y - viewerPos.y,\n                        box: {\n                            width: hotspotPos.s,\n                            height: hotspotPos.s,\n                        },\n                    });\n                }\n            }\n\n            this.state.hotspotId = hotspotId;\n        }\n    }\n\n    /**\n     * Dispatch event when a hotspot is clicked\n     */\n    private __clickHotspot(clientX: number, clientY: number) {\n        const hotspotId = this.__findHotspot(clientX, clientY);\n\n        if (hotspotId) {\n            this.plugin.dispatchEvent(new SelectHotspot(hotspotId));\n\n            if (hotspotId.startsWith(HOTSPOT_MARKER_ID)) {\n                const markerId = hotspotId.substring(HOTSPOT_MARKER_ID.length);\n                this.viewer.getPlugin<MarkersPlugin>('markers').gotoMarker(markerId);\n            }\n\n            if (this.maximized) {\n                this.toggleMaximized();\n            }\n        }\n\n        this.__resetHotspot();\n    }\n\n    private __resetHotspot() {\n        this.state.hotspotTooltip?.hide();\n        this.state.hotspotTooltip = null;\n        this.state.hotspotId = null;\n    }\n\n    private __loadImage(url: string, isInit = false): ImageSource {\n        if (!url) {\n            return null;\n        }\n\n        if (!this.state.images[url]) {\n            const image = loadImage(url);\n\n            this.state.images[url] = {\n                loading: true,\n                value: image,\n            };\n\n            image.onload = () => {\n                if (isInit && Math.max(image.width, image.height) > SYSTEM.maxCanvasWidth) {\n                    this.state.imgScale = SYSTEM.maxCanvasWidth / Math.max(image.width, image.height);\n\n                    const buffer = document.createElement('canvas');\n                    buffer.width = image.width * this.state.imgScale;\n                    buffer.height = image.height * this.state.imgScale;\n\n                    const ctx = buffer.getContext('2d');\n                    ctx.drawImage(image, 0, 0, buffer.width, buffer.height);\n\n                    this.state.images[url].value = buffer;\n                }\n\n                this.state.images[url].loading = false;\n                this.update();\n\n                if (isInit) {\n                    this.show();\n                }\n            };\n\n            return null;\n        }\n\n        if (this.state.images[url].loading) {\n            return null;\n        }\n\n        return this.state.images[url].value;\n    }\n}\n","export const MARKER_DATA_KEY = 'map';\nexport const HOTSPOT_GENERATED_ID = '__generated__';\nexport const HOTSPOT_MARKER_ID = '__marker__';\n\nexport const PIN_SHADOW_OFFSET = 2;\nexport const PIN_SHADOW_BLUR = 4;\nexport const MAP_SHADOW_BLUR = 10;\n","import { Point, SYSTEM } from '@photo-sphere-viewer/core';\n\nexport function loadImage(src: string): HTMLImageElement {\n    const image = document.createElement('img');\n\n    if (!src.includes('<svg')) {\n        image.src = src;\n    } else {\n        // the SVG must have it's own size, use the viewBox if not defined\n        if (!/<svg[^>]*width=\"/.test(src) && src.includes('viewBox')) {\n            const [, , , width, height] = /viewBox=\"([0-9-]+) ([0-9-]+) ([0-9]+) ([0-9]+)\"/.exec(src);\n            src = src.replace('<svg', `<svg width=\"${width}px\" height=\"${height}px\"`);\n        }\n\n        const src64 = `data:image/svg+xml;base64,${window.btoa(src)}`;\n        image.src = src64;\n    }\n\n    return image;\n}\n\nexport function getImageHtml(src: string): string {\n    if (!src) {\n        return '';\n    } else if (!src.includes('<svg')) {\n        return `<img src=\"${src}\">`;\n    } else {\n        return src;\n    }\n}\n\nexport function unprojectPoint(pt: Point, yaw: number, zoom: number): Point {\n    return {\n        x: (Math.cos(yaw) * pt.x - Math.sin(yaw) * pt.y) / zoom,\n        y: (Math.sin(yaw) * pt.x + Math.cos(yaw) * pt.y) / zoom,\n    };\n}\n\nexport function projectPoint(pt: Point, yaw: number, zoom: number): Point {\n    return {\n        x: (Math.cos(-yaw) * pt.x - Math.sin(-yaw) * pt.y) * zoom,\n        y: (Math.sin(-yaw) * pt.x + Math.cos(-yaw) * pt.y) * zoom,\n    };\n}\n\nexport type ImageSource = HTMLImageElement | HTMLCanvasElement;\n\n/**\n * Setup the canvas drop shadow\n */\nexport function canvasShadow(\n    context: CanvasRenderingContext2D,\n    offsetX: number,\n    offsetY: number,\n    blur: number,\n    color = 'black'\n) {\n    context.shadowOffsetX = offsetX * SYSTEM.pixelRatio;\n    context.shadowOffsetY = offsetY * SYSTEM.pixelRatio;\n    context.shadowBlur = blur * SYSTEM.pixelRatio;\n    context.shadowColor = color;\n}\n\n/**\n * Draw an image centered\n */\nexport function drawImageCentered(\n    context: CanvasRenderingContext2D,\n    image: ImageSource,\n    size: number\n) {\n    const w = image.width;\n    const h = image.height;\n\n    // prettier-ignore\n    drawImageHighDpi(\n        context,\n        image,\n        -size / 2,\n        -((h / w) * size) / 2,\n        size,\n        (h / w) * size\n    );\n}\n\n/**\n * Standard \"drawImage\" using devicePixelRatio\n */\nexport function drawImageHighDpi(\n    context: CanvasRenderingContext2D,\n    image: ImageSource,\n    x: number,\n    y: number,\n    w: number,\n    h: number\n) {\n    context.drawImage(\n        image,\n        0, 0,\n        image.width, image.height,\n        x * SYSTEM.pixelRatio, y * SYSTEM.pixelRatio,\n        w * SYSTEM.pixelRatio, h * SYSTEM.pixelRatio\n    );\n}\n","import { CONSTANTS } from '@photo-sphere-viewer/core';\nimport icon from '../icons/map.svg';\nimport { AbstractMapButton, ButtonPosition } from './AbstractMapButton';\nimport type { MapComponent } from './MapComponent';\n\nexport class MapCloseButton extends AbstractMapButton {\n    constructor(map: MapComponent) {\n        super(map, ButtonPosition.DEFAULT);\n\n        this.container.addEventListener('click', (e) => {\n            map.toggleCollapse();\n            e.stopPropagation();\n        });\n    }\n\n    override applyConfig(): void {\n        super.applyConfig();\n        this.container.classList.add('psv-map__button-close');\n    }\n\n    override update() {\n        this.container.innerHTML = this.map.collapsed ? icon : CONSTANTS.ICONS.close;\n        this.container.title = this.map.collapsed ? this.viewer.config.lang['map'] : this.viewer.config.lang.close;\n    }\n}\n","import { AbstractComponent } from '@photo-sphere-viewer/core';\nimport { MapComponent } from './MapComponent';\n\nexport const enum ButtonPosition {\n    DEFAULT,\n    DIAGONAL,\n    HORIZONTAL,\n    VERTICAL,\n}\n\nconst INVERT_POSITIONS: Record<string, string> = {\n    top: 'bottom',\n    bottom: 'top',\n    left: 'right',\n    right: 'left',\n};\n\nfunction getButtonPosition(mapPosition: [string, string], direction: ButtonPosition): [string, string] {\n    switch (direction) {\n        case ButtonPosition.DIAGONAL:\n            return [INVERT_POSITIONS[mapPosition[0]], INVERT_POSITIONS[mapPosition[1]]];\n        case ButtonPosition.HORIZONTAL:\n            return [mapPosition[0], INVERT_POSITIONS[mapPosition[1]]];\n        case ButtonPosition.VERTICAL:\n            return [INVERT_POSITIONS[mapPosition[0]], mapPosition[1]];\n        default:\n            return mapPosition;\n    }\n}\n\nexport abstract class AbstractMapButton extends AbstractComponent {\n    constructor(protected map: MapComponent, private position: ButtonPosition) {\n        super(map, {});\n    }\n\n    applyConfig() {\n        // prettier-ignore\n        this.container.className = `psv-map__button psv-map__button--${getButtonPosition(this.map.config.position, this.position).join('-')}`;\n        this.update();\n    }\n\n    // eslint-disable-next-line @typescript-eslint/no-empty-function\n    update() {}\n}\n","import icon from '../icons/compass.svg';\nimport { AbstractMapButton, ButtonPosition } from './AbstractMapButton';\nimport type { MapComponent } from './MapComponent';\n\nexport class MapCompassButton extends AbstractMapButton {\n    constructor(map: MapComponent) {\n        super(map, ButtonPosition.VERTICAL);\n\n        this.container.innerHTML = icon;\n        this.container.querySelector('svg').style.width = '80%';\n\n        this.container.addEventListener('click', (e) => {\n            this.viewer.dynamics.position.goto({ yaw: -map.config.rotation }, 2);\n            e.stopPropagation();\n        });\n    }\n\n    rotate(angle: number) {\n        this.container.querySelector('svg').style.transform = `rotate3d(0, 0, 1, ${-angle}rad)`;\n    }\n}\n","import maximize from '../icons/maximize.svg';\nimport minimize from '../icons/minimize.svg';\nimport { AbstractMapButton, ButtonPosition } from './AbstractMapButton';\nimport type { MapComponent } from './MapComponent';\n\nconst ROTATION: Record<string, number> = {\n    'bottom-left': 0,\n    'bottom-right': -90,\n    'top-right': 180,\n    'top-left': 90,\n};\n\nexport class MapMaximizeButton extends AbstractMapButton {\n    constructor(map: MapComponent) {\n        super(map, ButtonPosition.DIAGONAL);\n\n        this.container.addEventListener('click', (e) => {\n            map.toggleMaximized();\n            e.stopPropagation();\n        });\n    }\n\n    override update() {\n        this.container.innerHTML = this.map.maximized ? minimize : maximize;\n        this.container.querySelector('svg').style.transform = `rotate3d(0, 0, 1, ${ROTATION[this.map.config.position.join('-')]}deg)`;\n        this.container.title = this.map.maximized\n            ? this.viewer.config.lang['mapMinimize']\n            : this.viewer.config.lang['mapMaximize'];\n    }\n}\n","import reset from '../icons/reset.svg';\nimport { AbstractMapButton, ButtonPosition } from './AbstractMapButton';\nimport type { MapComponent } from './MapComponent';\n\nexport class MapResetButton extends AbstractMapButton {\n    constructor(map: MapComponent) {\n        super(map, ButtonPosition.HORIZONTAL);\n\n        this.container.title = this.viewer.config.lang['mapReset'];\n        this.container.innerHTML = reset;\n        this.container.querySelector('svg').style.width = '80%';\n\n        this.container.addEventListener('click', (e) => {\n            map.reset();\n            e.stopPropagation();\n        });\n    }\n}\n","import { AbstractComponent, utils } from '@photo-sphere-viewer/core';\nimport minus from '../icons/minus.svg';\nimport plus from '../icons/plus.svg';\nimport type { MapComponent } from './MapComponent';\n\nexport class MapZoomToolbar extends AbstractComponent {\n    private readonly zoomIndicator: HTMLElement;\n    private readonly handler = new utils.PressHandler(100);\n    private time: number;\n    private animation?: ReturnType<typeof requestAnimationFrame>;\n\n    constructor(private map: MapComponent) {\n        super(map, {\n            className: 'psv-map__toolbar',\n        });\n\n        this.container.innerHTML = `${minus}<span class=\"psv-map__toolbar-text\">100%</span>${plus}`;\n\n        this.zoomIndicator = this.container.querySelector('.psv-map__toolbar-text');\n\n        const zoomButtons = this.container.querySelectorAll('svg');\n        zoomButtons[0].dataset['delta'] = '-1';\n        zoomButtons[1].dataset['delta'] = '1';\n\n        this.container.addEventListener('mousedown', this);\n        window.addEventListener('mouseup', this);\n        this.container.addEventListener('touchstart', this);\n        window.addEventListener('touchend', this);\n    }\n\n    override destroy(): void {\n        window.removeEventListener('mouseup', this);\n        window.removeEventListener('touchend', this);\n\n        super.destroy();\n    }\n\n    handleEvent(e: Event) {\n        switch (e.type) {\n            case 'mousedown':\n            case 'touchstart': {\n                const button = utils.getClosest(e.target as HTMLElement, 'svg');\n                const delta: string = button?.dataset['delta'];\n                if (delta) {\n                    cancelAnimationFrame(this.animation);\n                    this.handler.down();\n                    this.time = performance.now();\n                    this.animateZoom(parseInt(delta, 10));\n                    e.preventDefault();\n                    e.stopPropagation();\n                }\n                break;\n            }\n            case 'mouseup':\n            case 'touchend':\n                if (this.animation) {\n                    this.handler.up(() => {\n                        cancelAnimationFrame(this.animation);\n                        this.animation = null;\n                    });\n                    e.preventDefault();\n                    e.stopPropagation();\n                }\n                break;\n            default:\n                break;\n        }\n    }\n\n    setText(zoom: number) {\n        this.zoomIndicator.innerText = `${Math.round(Math.exp(zoom) * 100)}%`;\n    }\n\n    private animateZoom(delta: number) {\n        this.animation = requestAnimationFrame((t) => {\n            this.map.zoom((delta * (t - this.time)) / 1000);\n            this.time = t;\n            this.animateZoom(delta);\n        });\n    }\n}\n"],"mappings":"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","names":["import_core","import_core","import_core","import_core","import_core","import_core","import_core"]}